<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>NumiaInsurance - Innova tus seguros</title>
  <!-- FAVICON para la pestaña -->
  <link rel="icon" type="image/png" href="images/N.png" />
  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet"/>
  <!-- Bootstrap Icons -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css" rel="stylesheet">
  <!-- Google Font Roboto -->
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet"/>
  <style>
    /* --- Variables de color (se mantiene look & feel) --- */
    :root {
      --numia-azul: #863DFF;
      --numia-azul-claro: #e6ecf9; /* para fondos suaves */
      --numia-azul-muy-claro: #eef2fc; /* para segunda franja */
    }

    body {
      font-family: 'Roboto', Arial, sans-serif;
      background: #f7f7f7;
    }
    .card.ad-card {
      border-radius: 1.2rem;
      box-shadow: 0 4px 18px rgba(0,0,0,0.08);
      transition: transform 0.18s, box-shadow 0.18s;
      min-width: 210px;
      min-height: 380px;
      display: flex;
      flex-direction: column;
      justify-content: stretch;
      height: 100%;
    }
    .card.ad-card:hover {
      transform: translateY(-4px) scale(1.025);
      box-shadow: 0 8px 32px rgba(0,19,145,0.17);
    }
    .card-img-top-holder {
      width: 100%;
      height: 180px;
      display: flex;
      align-items: center;
      justify-content: center;
      overflow: hidden;
      background: #fff8f8;
      border-top-left-radius: 1.2rem;
      border-top-right-radius: 1.2rem;
    }
    .card-img-top-holder img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      object-position: center;
      transition: transform 0.3s;
    }
    .ad-card .card-body {
      display: flex;
      flex-direction: column;
      justify-content: flex-start;
      height: 100%;
      padding-bottom: 1.5rem;
    }
    .ad-card .card-title {
      font-weight: 700;
      color: var(--numia-azul);
      font-size: 1.25rem;
      margin-bottom: .25rem;
      margin-top: 1rem;
      min-height: 3rem;
      display: flex;
      align-items: center;
      justify-content: center;
      text-align: center;
    }
    .ad-card .card-text {
      font-size: 1.01rem;
      color: #2d2d2d;
      font-weight: 500;
      opacity: 0.88;
      margin-bottom: 1.1rem;
      min-height: 56px;
      text-align: center;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .carousel-item img {
      object-fit: cover;
      width: 100%;
      height: 340px;
      border-radius: 0.7rem;
    }
    @media (max-width: 991px) {
      .main-cards .col-lg-3 {
        flex: 0 0 50%;
        max-width: 50%;
        margin-bottom: 1rem;
      }
      .carousel-item img {
        height: 180px;
      }
    }
    @media (max-width: 767px) {
      .main-cards .col-lg-3 {
        flex: 0 0 100%;
        max-width: 100%;
      }
      .carousel-item img {
        height: 140px;
      }
      .card-img-top-holder {
        height: 140px;
      }
      .ad-card .card-title { font-size: 1.08rem; }
    }

    /* --- Sección de Planes/Coberturas (antes Divisas/Tasas) --- */
    .rates-section {
      display: flex;
      gap: 2.2rem;
      align-items: stretch;
      margin: 36px 0 0 0;
      width: 100%;
      flex-wrap: wrap;
    }
    .rates-col-table {
      background: #fff;
      border-radius: 1.1rem;
      box-shadow: 0 2px 12px rgba(0,0,0,0.07);
      padding: 2.1rem 1.6rem 1.6rem 1.7rem;
      min-width: 340px;
      flex: 2 1 540px;
      max-width: 1000px;
      display: flex;
      flex-direction: column;
      justify-content: flex-start;
    }
    .rates-col-side {
      background: #fff;
      border-radius: 1.1rem;
      box-shadow: 0 2px 12px rgba(0,0,0,0.07);
      padding: 2.1rem 1.6rem 1.6rem 1.7rem;
      min-width: 220px;
      flex: 1 1 320px;
      max-width: 420px;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: flex-start;
    }
    .rates-col-side .bi {
      font-size: 2.6rem;
      color: var(--numia-azul);
      margin-bottom: .7rem;
    }
    .rates-col-side h5 {
      color: var(--numia-azul);
      font-weight: 700;
      margin-bottom: .5rem;
      font-size: 1.2rem;
    }
    .rates-col-side p {
      color: #444;
      font-size: 1.07rem;
      font-weight: 500;
      margin-bottom: 1.2rem;
      opacity: .93;
    }
    .rates-col-side .btn {
      background: var(--numia-azul);
      border: none;
      color: #fff;
      font-weight: 700;
      border-radius: 24px;
      padding: 0.7rem 2.1rem;
      font-size: 1.07rem;
      box-shadow: 0 2px 7px rgba(0,19,145,0.06);
      transition: background 0.18s;
    }
    .rates-col-side .btn:hover {
      background: #000d73;
      color: #fff;
    }

    /* --- Botones de pestañas --- */
    .rates-tab-btn {
      padding: .7rem 0;
      border: none;
      border-radius: 9px;
      font-weight: bold;
      font-size: 1.1rem;
      background: #fff;
      color: var(--numia-azul);
      margin-bottom: 0;
      transition: background .16s, color .16s;
      cursor: pointer;
      box-shadow: none;
      outline: none;
      border: 2px solid #d1d9f9;
      min-width: 70px;
    }
    .rates-tab-btn.active,
    .rates-tab-btn:focus {
      background: var(--numia-azul);
      color: #fff;
      border: 2px solid var(--numia-azul);
    }

    /* --- Tabla --- */
    .rates-table {
      width: 100%;
      border-collapse: separate;
      border-spacing: 0;
      background: #fff;
      border-radius: 0.8rem;
      overflow: hidden;
      margin-top: 0.7rem;
    }
    .rates-table th,
    .rates-table td {
      padding: 12px 18px;
      font-size: 1.04rem;
      text-align: left;
    }
    .rates-table th {
      color: var(--numia-azul);
      background: var(--numia-azul-claro);
      border: none;
      font-size: 1.08rem;
      font-weight: 700;
      text-align: center;
      letter-spacing: 0.02em;
    }
    .rates-table tr:not(:last-child) {
      border-bottom: 1px solid #cde0f8;
    }
    .rates-table tr:nth-child(2) {
      background: var(--numia-azul-claro);
    }
    .rates-table tr:nth-child(3) {
      background: var(--numia-azul-muy-claro);
    }
    .rates-table td {
      color: #222;
      font-weight: 500;
      text-align: center;
      vertical-align: middle;
    }
    .rates-table td:first-child,
    .rates-table th:first-child {
      text-align: left;
    }

    @media (max-width: 1300px) {
      .rates-col-table {
        min-width: 0;
        flex-basis: 400px;
      }
      .rates-col-side {
        min-width: 0;
      }
    }
    @media (max-width: 991px) {
      .rates-section {
        flex-direction: column;
        gap: 1.4rem;
      }
      .rates-col-table,
      .rates-col-side {
        min-width: 0;
        max-width: 100%;
      }
      .rates-col-side {
        align-items: flex-start;
        padding-top: 1.2rem;
      }
    }

    /* --- Botones principales al color corporativo --- */
    .btn-primary {
      background-color: var(--numia-azul) !important;
      border-color: var(--numia-azul) !important;
    }
    .btn-primary:hover {
      background-color: #000d73 !important;
      border-color: #000d73 !important;
    }
    .btn-outline-primary {
      color: var(--numia-azul) !important;
      border-color: var(--numia-azul) !important;
    }
    .btn-outline-primary:hover {
      background-color: var(--numia-azul) !important;
      color: #fff !important;
    }

    /* Botones del chat */
    #max-chat { background: var(--numia-azul) !important; }
    #open-chat { background: var(--numia-azul) !important; }

    /* ======== UX citas (personalización seguros, sin cambios funcionales) ======== */
    #modalCita .modal-dialog { max-width: 920px; }
    #modalCita .modal-content { border-radius: 16px; border: 0; box-shadow: 0 14px 40px rgba(0,0,0,.12); }
    #modalCita .modal-header { border-bottom: 1px solid #eef2fc; }
    #modalCita .modal-body { padding-top: .75rem; }
    #modalCita .modal-title .bi { color: var(--numia-azul); }

    .cita-toolbar {
      position: sticky; top: 0; z-index: 2; background: #fff;
      padding-bottom: .5rem; margin-bottom: .75rem; border-bottom: 1px solid #eef2fc;
    }
    #citaSchedule, #citaBranch, #citaFecha { border-radius: 10px; }
    #citaSlots {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(88px, 1fr));
      gap: .5rem;
      max-height: 320px;
      overflow: auto;
      padding-right: .25rem;
    }
    #citaSlots .btn {
      border-radius: 10px;
      border: 1px solid #c9b6ff;
      font-weight: 600;
      padding: .45rem .3rem;
    }
    #citaSlots .btn:hover { background: #f6f3ff; }
    #citaSlots .btn.active,
    #citaSlots .btn:focus {
      background: var(--numia-azul);
      color: #fff;
      border-color: var(--numia-azul);
    }
    .cita-legend { font-size: .8rem; color: #6c6c7a; }
    /* Chips visuales para ramo de seguro */
    .chip {
      display:inline-flex; align-items:center; gap:.35rem;
      padding:.25rem .6rem; border-radius:999px; font-weight:600; font-size:.85rem;
      background: var(--numia-azul-claro); color:#2b2b2b; border:1px solid #d9dffc;
    }

    @media (max-width: 576px) {
      #citaSlots { max-height: 260px; }
    }
  </style>
</head>
<body class="d-flex flex-column min-vh-100">

  <!-- Encabezado con logos -->
  <header class="bg-white shadow-sm py-2 mb-0">
    <div class="container">
      <div class="d-flex justify-content-between align-items-right">
        <a href="index.html" class="d-block">
          <img src="images/numia.png" alt="Numia Insurance Logo" class="img-fluid" style="max-height: 88px;" />
        </a>
      </div>
      <p class="lead mt-2 mb-0 text-dark text-start" style="font-size:1rem;">
        Protección inteligente para tu vida, salud, auto y hogar — con la tecnología de Numia
      </p>
    </div>
  </header>

  <!-- NAVBAR principal -->
  <nav class="navbar navbar-expand-lg navbar-light bg-white shadow-sm border-bottom" style="z-index:1050;">
    <div class="container">
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarMain" aria-controls="navbarMain" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse justify-content-center" id="navbarMain">
        <ul class="navbar-nav mb-2 mb-lg-0">
          <li class="nav-item dropdown px-2">
            <a class="nav-link dropdown-toggle fw-semibold" href="#" id="segurosProductos" role="button" data-bs-toggle="dropdown" aria-expanded="false">
              <i class="bi bi-shield-check me-1"></i>Seguros
            </a>
            <ul class="dropdown-menu" aria-labelledby="segurosProductos">
              <li><a class="dropdown-item" href="#"><i class="bi bi-truck-front me-2"></i>Auto</a></li>
              <li><a class="dropdown-item" href="#"><i class="bi bi-heart-pulse me-2"></i>Salud</a></li>
              <li><a class="dropdown-item" href="#"><i class="bi bi-person-heart me-2"></i>Vida</a></li>
              <li><a class="dropdown-item" href="#"><i class="bi bi-house-heart me-2"></i>Hogar</a></li>
            </ul>
          </li>
          <li class="nav-item dropdown px-2">
            <a class="nav-link dropdown-toggle fw-semibold" href="#" id="cotizaDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
              <i class="bi bi-calculator me-1"></i>Cotiza
            </a>
            <ul class="dropdown-menu" aria-labelledby="cotizaDropdown">
              <li><a class="dropdown-item" href="#"><i class="bi bi-speedometer2 me-2"></i>Seguro de Auto</a></li>
              <li><a class="dropdown-item" href="#"><i class="bi bi-heart-pulse me-2"></i>Gastos Médicos</a></li>
              <li><a class="dropdown-item" href="#"><i class="bi bi-person-vcard me-2"></i>Vida</a></li>
              <li><a class="dropdown-item" href="#"><i class="bi bi-house-door me-2"></i>Hogar</a></li>
            </ul>
          </li>
          <li class="nav-item dropdown px-2">
            <a class="nav-link dropdown-toggle fw-semibold" href="#" id="siniestrosDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
              <i class="bi bi-exclamation-triangle me-1"></i>Siniestros
            </a>
            <ul class="dropdown-menu" aria-labelledby="siniestrosDropdown">
              <li><a class="dropdown-item" href="#"><i class="bi bi-telephone-inbound me-2"></i>Reportar siniestro</a></li>
              <li><a class="dropdown-item" href="#"><i class="bi bi-clock-history me-2"></i>Seguimiento</a></li>
              <li><a class="dropdown-item" href="#"><i class="bi bi-geo-alt me-2"></i>Talleres y clínicas</a></li>
            </ul>
          </li>
          <li class="nav-item dropdown px-2">
            <a class="nav-link dropdown-toggle fw-semibold" href="#" id="asistenciaDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
              <i class="bi bi-headset me-1"></i>Asistencias
            </a>
            <ul class="dropdown-menu" aria-labelledby="asistenciaDropdown">
              <li><a class="dropdown-item" href="#"><i class="bi bi-wrench-adjustable me-2"></i>Vial 24/7</a></li>
              <li><a class="dropdown-item" href="#"><i class="bi bi-thermometer-half me-2"></i>Telemedicina</a></li>
              <li><a class="dropdown-item" href="#"><i class="bi bi-house-add me-2"></i>Hogar</a></li>
            </ul>
          </li>
          <li class="nav-item dropdown px-2">
            <a class="nav-link dropdown-toggle fw-semibold" href="#" id="miCuentaDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
              <i class="bi bi-person-circle me-1"></i>Mi cuenta
            </a>
            <ul class="dropdown-menu" aria-labelledby="miCuentaDropdown">
              <li><a class="dropdown-item" href="#"><i class="bi bi-file-earmark-text me-2"></i>Mis pólizas</a></li>
              <li><a class="dropdown-item" href="#"><i class="bi bi-receipt me-2"></i>Pagos y renovaciones</a></li>
              <li><a class="dropdown-item" href="#"><i class="bi bi-chat-dots me-2"></i>Contactar asesor</a></li>
            </ul>
          </li>
        </ul>
      </div>
    </div>
  </nav>

  <!-- Carrusel -->
  <div class="container mb-4">
    <div id="carouselMain" class="carousel slide shadow-sm rounded-3" data-bs-ride="carousel">
      <div class="carousel-inner">
        <div class="carousel-item active">
          <img src="images/carrusel1.png" class="d-block w-100" alt="Promo seguros 1">
          <div class="carousel-caption d-none d-md-block">
            <h5 class="fw-bold display-6" style="text-shadow: 0 2px 12px rgba(0,0,0,0.36)">Protección total</h5>
            <p class="fs-4">Asegura auto, salud y vida con descuentos por multipóliza</p>
            <a href="#" class="btn btn-primary btn-lg rounded-pill mt-2 px-4 fw-bold">Conoce más</a>
          </div>
        </div>
        <div class="carousel-item">
          <img src="images/carrusel2.png" class="d-block w-100" alt="Promo seguros 2">
          <div class="carousel-caption d-none d-md-block">
            <h5 class="fw-bold display-6">Gestión 100% digital</h5>
            <p class="fs-4">Cotiza, compra y da seguimiento a tus siniestros 24/7</p>
            <a href="#" class="btn btn-outline-light btn-lg rounded-pill mt-2 px-4 fw-bold">Regístrate aquí</a>
          </div>
        </div>
        <div class="carousel-item">
          <img src="images/carrusel3.jpg" class="d-block w-100" alt="Promo seguros 3">
          <div class="carousel-caption d-none d-md-block">
            <h5 class="fw-bold display-6">Salud y Vida</h5>
            <p class="fs-4">Planes flexibles con coberturas a tu medida</p>
            <a href="#" class="btn btn-primary btn-lg rounded-pill mt-2 px-4 fw-bold">Cotiza ahora</a>
          </div>
        </div>
      </div>
      <button class="carousel-control-prev" type="button" data-bs-target="#carouselMain" data-bs-slide="prev">
        <span class="carousel-control-prev-icon bg-dark rounded-circle" aria-hidden="true"></span>
        <span class="visually-hidden">Anterior</span>
      </button>
      <button class="carousel-control-next" type="button" data-bs-target="#carouselMain" data-bs-slide="next">
        <span class="carousel-control-next-icon bg-dark rounded-circle" aria-hidden="true"></span>
        <span class="visually-hidden">Siguiente</span>
      </button>
      <div class="carousel-indicators">
        <button type="button" data-bs-target="#carouselMain" data-bs-slide-to="0" class="active" aria-current="true" aria-label="Slide 1"></button>
        <button type="button" data-bs-target="#carouselMain" data-bs-slide-to="1" aria-label="Slide 2"></button>
        <button type="button" data-bs-target="#carouselMain" data-bs-slide-to="2" aria-label="Slide 3"></button>
      </div>
    </div>
  </div>

  <!-- TARJETAS -->
  <main class="container mb-5">
    <div class="row g-4 justify-content-center main-cards">
      <div class="col-lg-3 col-md-6">
        <div class="card ad-card h-100 text-center">
          <div class="card-img-top-holder">
            <img src="images/Tarjeta de credito.jpg" alt="Asesor de Seguros">
          </div>
          <div class="card-body">
            <h5 class="card-title">Agenda con un asesor</h5>
            <p class="card-text">Recibe asesoría personalizada para elegir tu póliza ideal en minutos.</p>
            <button class="btn btn-primary rounded-pill px-4 mt-2 fw-bold" disabled>Agendar</button>
          </div>
        </div>
      </div>
      <div class="col-lg-3 col-md-6">
        <div class="card ad-card h-100 text-center">
          <div class="card-img-top-holder">
            <img src="images/Apertura de cuenta.png" alt="Cotizador">
          </div>
          <div class="card-body">
            <h5 class="card-title">Cotiza tu seguro</h5>
            <p class="card-text">Compara planes de auto, salud, vida y hogar en un solo lugar.</p>
            <button class="btn btn-outline-primary rounded-pill px-4 mt-2 fw-bold" disabled>Comenzar</button>
          </div>
        </div>
      </div>
      <div class="col-lg-3 col-md-6">
        <div class="card ad-card h-100 text-center">
          <div class="card-img-top-holder">
            <img src="images/segurodeauto.png" alt="Auto">
          </div>
          <div class="card-body">
            <h5 class="card-title">Seguro de Auto</h5>
            <p class="card-text">Coberturas amplias con asistencia vial 24/7 y auto sustituto.</p>
            <button class="btn btn-primary rounded-pill px-4 mt-2 fw-bold" disabled>Simular prima</button>
          </div>
        </div>
      </div>
      <div class="col-lg-3 col-md-6">
        <div class="card ad-card h-100 text-center">
          <div class="card-img-top-holder">
            <img src="images/Seguro vida.jpg" alt="Salud y Vida">
          </div>
          <div class="card-body">
            <h5 class="card-title">Salud y Vida</h5>
            <p class="card-text">Protección para ti y tu familia con acceso a telemedicina.</p>
            <button class="btn btn-outline-primary rounded-pill px-4 mt-2 fw-bold" disabled>Conoce más</button>
          </div>
        </div>
      </div>
    </div>

    <!-- SECCIÓN: PLANES y COBERTURAS (sustituye divisas/tasas e inversiones) -->
    <div class="rates-section mt-5 mb-4">
      <div class="rates-col-table">
        <div class="d-flex gap-3 mb-2">
          <button class="rates-tab-btn active" id="tabDivisas" onclick="showRatesTab('divisas')">Planes</button>
          <button class="rates-tab-btn" id="tabTasas" onclick="showRatesTab('tasas')">Coberturas</button>
        </div>
        <!-- Tabla de PLANES -->
        <table class="rates-table" id="tablaDivisas">
          <thead>
            <tr>
              <th>Plan</th>
              <th>Prima mensual desde</th>
              <th>Deducible</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>Auto Esencial</td>
              <td>$299 MXN</td>
              <td>$6,000 MXN</td>
            </tr>
            <tr>
              <td>Salud Plus</td>
              <td>$750 MXN</td>
              <td>$3,500 MXN</td>
            </tr>
            <tr>
              <td>Vida Integral</td>
              <td>$420 MXN</td>
              <td>Sin deducible</td>
            </tr>
          </tbody>
        </table>
        <!-- Tabla de COBERTURAS -->
        <table class="rates-table" id="tablaTasas" style="display:none;">
          <thead>
            <tr>
              <th>Cobertura</th>
              <th>Auto</th>
              <th>Salud</th>
              <th>Vida</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>Daños a terceros</td>
              <td>✔</td><td>—</td><td>—</td>
            </tr>
            <tr>
              <td>Robo total</td>
              <td>✔</td><td>—</td><td>—</td>
            </tr>
            <tr>
              <td>Gastos médicos mayores</td>
              <td>—</td><td>✔</td><td>—</td>
            </tr>
            <tr>
              <td>Indemnización por fallecimiento</td>
              <td>—</td><td>—</td><td>✔</td>
            </tr>
          </tbody>
        </table>
      </div>
      <div class="rates-col-side">
        <i class="bi bi-file-earmark-text"></i>
        <h5 class="mb-1" style="font-weight:700;">Tus pólizas Numia</h5>
        <p class="mb-2">
          <strong>Auto:</strong> $389/mes · <span class="text-muted">Renueva 15/09</span><br>
          <strong>Salud:</strong> $820/mes · <span class="text-muted">Renueva 21/11</span>
        </p>
        <p class="mb-3">
          <span class="chip"><i class="bi bi-truck-front"></i> Auto</span>
          <span class="chip"><i class="bi bi-heart-pulse"></i> Salud</span>
          <span class="chip"><i class="bi bi-person-heart"></i> Vida</span>
          <span class="chip"><i class="bi bi-house-heart"></i> Hogar</span>
        </p>
        <button class="btn" disabled>Gestionar pólizas</button>
      </div>
    </div>
  </main>

  <!-- Pie de página -->
  <footer class="bg-light text-center py-3 mt-auto border-top">
    <small>&copy; NumiaInsurance. Todos los derechos reservados.</small>
  </footer>

  <!-- ===================== MODAL DE CITAS (personalizado a seguros) ===================== -->
  <div class="modal fade" id="modalCita" tabindex="-1" aria-labelledby="modalCitaLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="modalCitaLabel">
            <i class="bi bi-calendar2-week me-2"></i>Agenda tu asesoría de seguros
          </h5>
          <button class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
        </div>

        <div class="modal-body">
          <div id="citaAlert" class="alert d-none"></div>

          <!-- Barra superior con selects + fecha -->
          <div class="cita-toolbar">
            <div class="row g-3 align-items-end">
              <div class="col-lg-4">
                <label class="form-label fw-semibold">Ramo / Agenda</label>
                <select id="citaSchedule" class="form-select">
                  <option value="">Cargando...</option>
                </select>
              </div>
              <div class="col-lg-4">
                <label class="form-label fw-semibold">Centro de atención</label>
                <select id="citaBranch" class="form-select" disabled>
                  <option value="">Selecciona un ramo</option>
                </select>
              </div>
              <div class="col-lg-4">
                <label class="form-label fw-semibold">Fecha</label>
                <div class="d-flex gap-2">
                  <input id="citaFecha" type="date" class="form-control" disabled/>
                </div>
              </div>
            </div>
          </div>

          <!-- Chips de ayuda contextual -->
          <div class="mb-3">
            <span class="chip"><i class="bi bi-truck-front"></i> Auto</span>
            <span class="chip"><i class="bi bi-heart-pulse"></i> Salud</span>
            <span class="chip"><i class="bi bi-person-heart"></i> Vida</span>
            <span class="chip"><i class="bi bi-house-heart"></i> Hogar</span>
          </div>

          <!-- Grid de horarios -->
          <div class="mb-3">
            <label class="form-label fw-semibold">Horarios disponibles</label>
            <div id="citaSlots"></div>
          </div>

          <hr class="my-3">

          <!-- Datos del cliente -->
          <div class="row g-3">
            <div class="col-md-6">
              <label class="form-label fw-semibold">Nombre</label>
              <input id="citaFirst" class="form-control" placeholder="Nombre">
            </div>
            <div class="col-md-6">
              <label class="form-label fw-semibold">Apellido</label>
              <input id="citaLast" class="form-control" placeholder="Apellido">
            </div>
            <div class="col-md-6">
              <label class="form-label fw-semibold">DNI</label>
              <input id="citaDni" class="form-control" placeholder="Documento">
            </div>
            <div class="col-md-6">
              <label class="form-label fw-semibold">Email</label>
              <input id="citaMail" type="email" class="form-control" placeholder="correo@dominio.com">
            </div>
          </div>

        </div>

        <div class="modal-footer">
          <div class="me-auto cita-legend">Selecciona un horario para habilitar la confirmación.</div>
          <button class="btn btn-outline-secondary" data-bs-dismiss="modal">Cancelar</button>
          <button id="citaConfirmar" class="btn btn-primary" disabled>Confirmar cita</button>
        </div>
      </div>
    </div>
  </div>
  <!-- =================== FIN MODAL DE CITAS =================== -->

  <!-- Bootstrap JS Bundle -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

  <!-- 
    JavaScript para:
    1) Conmutar pestañas Planes / Coberturas (se reaprovecha la función)
    2) Controlar la apertura/maximización del chat
  -->
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      // Función de pestañas (reusa IDs existentes)
      function showRatesTab(tab) {
        const tabDivisas = document.getElementById('tabDivisas');
        const tabTasas = document.getElementById('tabTasas');
        const tablaDivisas = document.getElementById('tablaDivisas');
        const tablaTasas = document.getElementById('tablaTasas');
        if (tab === 'divisas') {
          tabDivisas.classList.add('active');
          tabTasas.classList.remove('active');
          tablaDivisas.style.display = '';
          tablaTasas.style.display = 'none';
        } else {
          tabDivisas.classList.remove('active');
          tabTasas.classList.add('active');
          tablaDivisas.style.display = 'none';
          tablaTasas.style.display = '';
        }
      }
      window.showRatesTab = showRatesTab;

      // Control de la burbuja de chat
      const iframe = document.getElementById('numia-chat-bubble');
      const btn = document.getElementById('max-chat');
      const openBtn = document.getElementById('open-chat');
      let maximized = false;

      openBtn.onclick = function() {
        iframe.style.display = 'block';
        btn.style.display = 'flex';
        openBtn.style.display = 'none';
      };
      btn.onclick = function() {
        if (!maximized) {
          iframe.style.width = '98vw';
          iframe.style.height = '94vh';
          iframe.style.bottom = '3vh';
          iframe.style.right = '1vw';
          iframe.style.boxShadow = 'none';
          btn.style.bottom = 'calc(94vh + 3vh + 12px)';
          btn.textContent = '🗗';
          maximized = true;
        } else {
          iframe.style.width = '370px';
          iframe.style.height = '550px';
          iframe.style.bottom = '24px';
          iframe.style.right = '24px';
          iframe.style.boxShadow = 'none';
          btn.style.bottom = '590px';
          btn.textContent = '⛶';
          maximized = false;
        }
      };
    });
  </script>

  <!-- ================== JS de la integración de citas (TOKEN actualizado) ================== -->
  <script>
    (function(){
      const API_TOKEN = 'VwJ3ACdnXWPdnjEwLxs0mKoRHvCU23tGLYryRiF1';
      const SVC_LIST   = 'https://citas2.debmedia.com/api/v2/reducedSchedules';
      const AVAIL_BASE = 'https://citas2.debmedia.com/api/v2/schedules';
      const APPT_URL   = 'https://citas2.debmedia.com/api/v2/appointments';

      // Elementos UI
      const modalEl = document.getElementById('modalCita');
      const modal = new bootstrap.Modal(modalEl);
      const btnPrimaryCards = document.querySelectorAll('.ad-card .btn.btn-primary');
      const alertBox = document.getElementById('citaAlert');
      const selSchedule = document.getElementById('citaSchedule');
      const selBranch   = document.getElementById('citaBranch');
      const inputFecha  = document.getElementById('citaFecha');
      const slotsWrap   = document.getElementById('citaSlots');
      const btnConfirm  = document.getElementById('citaConfirmar');

      const inFirst = document.getElementById('citaFirst');
      const inLast  = document.getElementById('citaLast');
      const inDni   = document.getElementById('citaDni');
      const inMail  = document.getElementById('citaMail');

      // Estado
      let schedules = [];
      let selectedSlot = null;

      // Habilitar el primer botón primario ("Agendar") para abrir el modal
      if (btnPrimaryCards && btnPrimaryCards.length) {
        const btnSolicitar = btnPrimaryCards[0];
        btnSolicitar.removeAttribute('disabled');
        btnSolicitar.addEventListener('click', async () => {
          resetForm();
          modal.show();
          await loadSchedules();
        });
      }

      // Utilidades
      const pad = n => String(n).padStart(2,'0');
      const ymd = (d) => `${d.getFullYear()}-${pad(d.getMonth()+1)}-${pad(d.getDate())}`;
      function isoFromZonedStart(zonedStartDate) { return new Date(zonedStartDate); }
      function setAlert(type, msg){
        alertBox.className = `alert alert-${type}`;
        alertBox.textContent = msg;
        alertBox.classList.remove('d-none');
      }
      function clearAlert(){ alertBox.className = 'alert d-none'; alertBox.textContent=''; }

      function resetForm(){
        clearAlert();
        selSchedule.innerHTML = `<option value="">Cargando...</option>`;
        selBranch.innerHTML   = `<option value="">Selecciona un ramo</option>`;
        selBranch.disabled = true;
        inputFecha.value = '';
        inputFecha.disabled = true;
        slotsWrap.innerHTML = '';
        selectedSlot = null;
        btnConfirm.disabled = true;
        inFirst.value = ''; inLast.value = ''; inDni.value = ''; inMail.value = '';
      }

      async function loadSchedules(){
        try{
          const res = await fetch(SVC_LIST, { headers: { 'x-api-token': API_TOKEN } });
          if(!res.ok) throw new Error(`No se pudieron obtener las agendas (${res.status})`);
          schedules = await res.json();

          selSchedule.innerHTML = `<option value="">Selecciona un ramo...</option>`;
          schedules.forEach(s => {
            selSchedule.insertAdjacentHTML('beforeend', `<option value="${s.id}">${s.name}</option>`);
          });

          const today = new Date();
          inputFecha.min = ymd(today);
          inputFecha.disabled = false;

          selSchedule.onchange = handleScheduleChange;
          selBranch.onchange = handleBranchOrDateChange;
          inputFecha.onchange = handleBranchOrDateChange;

        }catch(err){
          setAlert('danger', err.message);
        }
      }

      function handleScheduleChange(){
        const schedId = selSchedule.value;
        selBranch.innerHTML = `<option value="">Selecciona centro...</option>`;
        selBranch.disabled = true;
        slotsWrap.innerHTML = '';
        btnConfirm.disabled = true;

        if(!schedId){ return; }

        const sched = schedules.find(s => String(s.id) === String(schedId));
        if(!sched || !Array.isArray(sched.branches)) {
          setAlert('danger', 'Esta agenda no tiene centros asociados.');
          return;
        }
        const seen = new Set();
        sched.branches.forEach(b=>{
          if(!seen.has(b.id)){
            selBranch.insertAdjacentHTML('beforeend', `<option value="${b.id}">${b.name}</option>`);
            seen.add(b.id);
          }
        });
        selBranch.disabled = false;
        clearAlert();
      }

      async function handleBranchOrDateChange(){
        clearAlert();
        slotsWrap.innerHTML = '';
        selectedSlot = null;
        btnConfirm.disabled = true;

        const schedId = selSchedule.value;
        const branchId = selBranch.value;
        const dateStr  = inputFecha.value;

        if(!schedId || !branchId || !dateStr){ return; }

        try{
          const url = `${AVAIL_BASE}/${encodeURIComponent(schedId)}/branch/${encodeURIComponent(branchId)}/availability?strDate=${encodeURIComponent(dateStr)}`;
          const res = await fetch(url, { headers: { 'x-api-token': API_TOKEN }});
          if(!res.ok) throw new Error(`No se pudo obtener disponibilidad (${res.status})`);
          const data = await res.json();

          const slots = Array.isArray(data) ? data : (Array.isArray(data.slots) ? data.slots : []);
          if(slots.length === 0){
            setAlert('info','No hay horarios disponibles para la fecha seleccionada.');
            return;
          }

          const frag = document.createDocumentFragment();
          slots.forEach(slot=>{
            const hora = slot.zonedStartDate.substring(11,16);
            const btn = document.createElement('button');
            btn.type = 'button';
            btn.className = 'btn btn-light';
            btn.textContent = hora;
            btn.addEventListener('click', ()=>{
              [...slotsWrap.querySelectorAll('.btn')].forEach(b=>b.classList.remove('active'));
              btn.classList.add('active');
              const startDate = isoFromZonedStart(slot.zonedStartDate);
              const end = new Date(startDate.getTime() + (slot.defaultDuration||0) * 60000);
              selectedSlot = { startAt: slot.zonedStartDate, endAt: end };
              btnConfirm.disabled = false;
            });
            frag.appendChild(btn);
          });
          slotsWrap.appendChild(frag);

        }catch(err){
          setAlert('danger', err.message);
        }
      }

      btnConfirm.addEventListener('click', async ()=>{
        clearAlert();
        if(!selectedSlot){ setAlert('danger','Selecciona un horario primero.'); return; }
        const schedId = selSchedule.value;
        const branchId = selBranch.value;
        if(!schedId || !branchId){ setAlert('danger','Faltan ramo o centro.'); return; }
        if(!inFirst.value || !inLast.value || !inDni.value){
          setAlert('danger','Completa Nombre, Apellido y DNI.');
          return;
        }

        const startDate = new Date(selectedSlot.startAt);
        const endDate   = new Date(selectedSlot.endAt);
        const fmt = (d)=>{
          const off = -d.getTimezoneOffset();
          const sign = off >= 0 ? '+' : '-';
          const pad = n => String(n).padStart(2,'0');
          const hh = pad(Math.floor(Math.abs(off)/60));
          const mm = pad(Math.abs(off)%60);
          return `${d.getFullYear()}-${pad(d.getMonth()+1)}-${pad(d.getDate())}T${pad(d.getHours())}:${pad(d.getMinutes())}:00${sign}${hh}${mm}`;
        };

        const body = {
          branch:   { id: Number(branchId) },
          schedule: { id: Number(schedId) },
          startAt:  fmt(startDate),
          endAt:    fmt(endDate),
          customer: {
            firstName: inFirst.value,
            lastName:  inLast.value,
            dni:       Number(inDni.value||0),
            email:     inMail.value || undefined
          },
          reason: "Asesoría de Seguros"
        };

        btnConfirm.disabled = true;
        btnConfirm.textContent = 'Confirmando...';

        try{
          const res = await fetch(APPT_URL, {
            method: 'POST',
            headers: {
              'x-api-token': API_TOKEN,
              'Content-Type': 'application/json'
            },
            body: JSON.stringify(body)
          });
          const out = await res.json().catch(()=> ({}));
          if(!res.ok){
            throw new Error(out?.message || `Error al crear la cita (${res.status})`);
          }
          setAlert('success', `¡Cita creada! ID: ${out.id || '(recibido)'}`);
          setTimeout(()=> modal.hide(), 1500);
        }catch(err){
          setAlert('danger', err.message);
        }finally{
          btnConfirm.disabled = false;
          btnConfirm.textContent = 'Confirmar cita';
        }
      });
    })();
  </script>
  <!-- ================== FIN JS de la integración de citas ================== -->

  <!-- CHAT (enlace actualizado con token) -->
  <iframe
    src="https://filavirtual.preprod.debmedia.com/Numiabot/#/VwJ3ACdnXWPdnjEwLxs0mKoRHvCU23tGLYryRiF1"
    id="numia-chat-bubble"
    style="
      position: fixed;
      bottom: 24px;
      right: 24px;
      width: 370px;
      height: 550px;
      border: none;
      z-index: 9999;
      border-radius: 18px;
      overflow: hidden;
      transition: width 0.3s, height 0.3s, right 0.3s, bottom 0.3s;
      display: none;
    "
    allow="camera; microphone"
  ></iframe>
  <button id="max-chat"
    style="
      position: fixed;
      bottom: 590px;
      right: 24px;
      z-index: 10000;
      background: var(--numia-azul);
      color: #fff;
      border: none;
      border-radius: 50%;
      width: 48px;
      height: 48px;
      font-size: 1.6rem;
      box-shadow: 0 2px 8px rgba(0,0,0,0.18);
      cursor: pointer;
      display: none;
      align-items: center;
      justify-content: center;
      transition: background 0.2s;
    "
    title="Maximizar/minimizar chat"
  >⛶</button>
  <button id="open-chat"
    style="
      position: fixed;
      bottom: 24px;
      right: 24px;
      z-index: 10001;
      background: var(--numia-azul);
      color: #fff;
      border: none;
      border-radius: 50%;
      width: 64px;
      height: 64px;
      font-size: 2.5rem;
      box-shadow: 0 2px 8px rgba(0,0,0,0.18);
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
    "
    title="Abrir chat"
  >
    <span style="font-weight:bold;font-size:2rem;">N</span>
  </button>
</body>
</html>
