<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>NumiaInsurance - Innova tus seguros</title>
  <!-- FAVICON para la pestaña -->
  <link rel="icon" type="image/png" href="images/N.png" />

  <!-- Bootstrap CSS -->
  <script src="https://debq2.debmedia.com/api/cobrowse/widget/5d8b569d2466aa0cd5b8b4756829f014"></script>
 
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet"/>
  <!-- Bootstrap Icons -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css" rel="stylesheet">
  <!-- Google Font Roboto -->
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet"/>
  <!-- Flatpickr CSS -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
  <style>
    /* --- Variables de color (se mantiene look & feel) --- */
    :root {
      --numia-azul: #863DFF;
      --numia-azul-claro: #e6ecf9; /* para fondos suaves */
      --numia-azul-muy-claro: #eef2fc; /* para segunda franja */
    }

    body {
      font-family: 'Roboto', Arial, sans-serif;
      background: #f7f7f7;
    }
    
    /* ======== ESTILOS PARA EL MODAL DE AGENDAR CITA (replicado de indexSalud) ======== */
    .boton-fecha {
      background-color: #863DFF;
      color: white;
      font-weight: 500;
      padding: 0.5rem 0.5rem;
      border-radius: 0.5rem;
      transition: background-color 0.2s ease;
      margin-top: 20px;
    }
    .boton-fecha:hover {
      background-color: #863DFF;
    }
    .input-field {
      width: 100%;
      padding: 0.75rem 1rem;
      border: 2px solid #d1d5db;
      border-radius: 0.5rem;
      background-color: #ffffff;
      color: #333;
      transition: all 0.2s ease;
    }
    .input-field:focus {
      border-color: #863DFF;
      box-shadow: 0 0 0 2px rgba(134, 61, 255, 0.2);
      outline: none;
    }
    h2, .titulo {
      text-align: center;
      color: #863DFF;
      margin-top: 20px;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 1px;
    }
    #formularioInicial, #resultados, #formularioDatos, #bloqueFecha {
      background-color: #ffffff;
      padding: 20px;
      border-radius: 0.75rem;
      box-shadow: 0 4px 20px rgba(0,0,0,0.1);
      margin-top: 20px;
    }
    #formularioInicial {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 20px;
    }
    
    /* Estilos para el selector moderno de sucursales */
    .sucursal-selector {
      margin-bottom: 20px;
      display: none; /* Oculto inicialmente hasta que se seleccione una especialidad */
    }
    
    .selector-label {
      display: block;
      font-weight: 600;
      color: #333;
      margin-bottom: 12px;
      font-size: 0.95rem;
    }
    
    .sucursal-cards {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 12px;
      max-height: 300px;
      overflow-y: auto;
    }
    
    .sucursal-card {
      background: #ffffff;
      border: 2px solid #e5e7eb;
      border-radius: 12px;
      padding: 16px;
      cursor: pointer;
      transition: all 0.3s ease;
      position: relative;
      display: flex;
      align-items: center;
      gap: 12px;
    }
    
    .sucursal-card:hover {
      border-color: #863DFF;
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(134, 61, 255, 0.15);
    }
    
    .sucursal-card.selected {
      border-color: #863DFF;
      background: linear-gradient(135deg, #863DFF, #9f5fff);
      color: white;
      box-shadow: 0 8px 25px rgba(134, 61, 255, 0.3);
    }
    
    .sucursal-card.selected:hover {
      transform: translateY(-2px);
      box-shadow: 0 12px 35px rgba(134, 61, 255, 0.4);
    }
    
    .sucursal-icon {
      font-size: 1.5rem;
      color: #863DFF;
      flex-shrink: 0;
    }
    
    .sucursal-card.selected .sucursal-icon {
      color: white;
    }
    
    .sucursal-info {
      flex: 1;
    }
    
    .sucursal-name {
      font-weight: 600;
      font-size: 0.95rem;
      margin-bottom: 4px;
    }
    
    .sucursal-card.selected .sucursal-name {
      color: white;
    }
    
    .sucursal-status {
      font-size: 0.8rem;
      color: #6b7280;
    }
    
    .sucursal-card.selected .sucursal-status {
      color: rgba(255, 255, 255, 0.9);
    }
    
    .loading-card {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      padding: 20px;
      color: #6b7280;
      font-style: italic;
    }
    
    .spin {
      animation: spin 1s linear infinite;
    }
    
    @keyframes spin {
      from { transform: rotate(0deg); }
      to { transform: rotate(360deg); }
    }
    
    .error-card {
      background: #fef2f2;
      border: 2px solid #fecaca;
      color: #dc2626;
      padding: 16px;
      border-radius: 12px;
      text-align: center;
    }
    
    .sucursal-cards:empty::after {
      content: "No hay sucursales disponibles";
      display: block;
      text-align: center;
      color: #6b7280;
      font-style: italic;
      padding: 20px;
    }
    
    /* Estilos para el selector de salas */
    .sala-selector {
      margin-bottom: 20px;
    }
    
    .sala-cards {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 12px;
      max-height: 300px;
      overflow-y: auto;
    }
    
    .sala-card {
      background: #ffffff;
      border: 2px solid #e5e7eb;
      border-radius: 12px;
      padding: 16px;
      cursor: pointer;
      transition: all 0.3s ease;
      position: relative;
      display: flex;
      align-items: center;
      gap: 12px;
    }
    
    .sala-card:hover {
      border-color: #863DFF;
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(134, 61, 255, 0.15);
    }
    
    .sala-card.selected {
      border-color: #863DFF;
      background: linear-gradient(135deg, #863DFF, #9f5fff);
      color: white;
      box-shadow: 0 8px 25px rgba(134, 61, 255, 0.3);
    }
    
    .sala-card.selected:hover {
      transform: translateY(-2px);
      box-shadow: 0 12px 35px rgba(134, 61, 255, 0.4);
    }
    
    .sala-icon {
      font-size: 1.5rem;
      color: #863DFF;
      flex-shrink: 0;
    }
    
    .sala-card.selected .sala-icon {
      color: white;
    }
    
    .sala-info {
      flex: 1;
    }
    
    .sala-name {
      font-weight: 600;
      font-size: 0.95rem;
      margin-bottom: 4px;
    }
    
    .sala-card.selected .sala-name {
      color: white;
    }
    
    .sala-status {
      font-size: 0.8rem;
      color: #6b7280;
    }
    
    .sala-card.selected .sala-status {
      color: rgba(255, 255, 255, 0.9);
    }
    
    .sala-cards:empty::after {
      content: "No hay salas disponibles";
      display: block;
      text-align: center;
      color: #6b7280;
      font-style: italic;
      padding: 20px;
    }
    
    /* Estilos para el selector de especialidades */
    .selectors-container {
      display: flex;
      gap: 1.5rem;
      margin-bottom: 1.5rem;
      flex-wrap: wrap;
    }
    
    .especialidad-selector,
    .sucursal-selector,
    .sala-selector {
      flex: 1;
      min-width: 250px;
      margin-bottom: 0;
    }
    
    .especialidad-cards {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
      gap: 10px;
      max-height: 200px;
      overflow-y: auto;
    }
    
    .especialidad-card {
      background: #ffffff;
      border: 2px solid #e5e7eb;
      border-radius: 12px;
      padding: 16px;
      cursor: pointer;
      transition: all 0.3s ease;
      position: relative;
      display: flex;
      align-items: center;
      gap: 12px;
    }
    
    .especialidad-card:hover {
      border-color: #863DFF;
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(134, 61, 255, 0.15);
    }
    
    .especialidad-card.selected {
      border-color: #863DFF;
      background: linear-gradient(135deg, #863DFF, #9f5fff);
      color: white;
      box-shadow: 0 8px 25px rgba(134, 61, 255, 0.3);
    }
    
    .especialidad-card.selected:hover {
      transform: translateY(-2px);
      box-shadow: 0 12px 35px rgba(134, 61, 255, 0.4);
    }
    
    .especialidad-icon {
      font-size: 1.5rem;
      color: #863DFF;
      flex-shrink: 0;
    }
    
    .especialidad-card.selected .especialidad-icon {
      color: white;
    }
    
    .especialidad-info {
      flex: 1;
    }
    
    .especialidad-name {
      font-weight: 600;
      font-size: 0.95rem;
      margin-bottom: 4px;
    }
    
    .especialidad-card.selected .especialidad-name {
      color: white;
    }
    
    .especialidad-status {
      font-size: 0.8rem;
      color: #6b7280;
    }
    
    .especialidad-card.selected .especialidad-status {
      color: rgba(255, 255, 255, 0.9);
    }
    
    #formularioTurno {
      display: flex;
      flex-direction: column;
      gap: 15px;
    }
    
    /* Popup */
    .modal {
      display: none;
      position: fixed;
      z-index: 1000;
      left: 0; top: 0;
      width: 100%; height: 100%;
      overflow: auto;
      background-color: rgba(0,0,0,0.5);
    }
    .modal-content {
      background-color: #fff;
      margin: 2% auto;
      padding: 20px;
      border-radius: 8px;
      width: 95%;
      max-width: 1200px;
      max-height: 90vh;
      overflow-y: auto;
      position: relative;
    }
    .close {
      position: absolute;
      right: 15px;
      top: 10px;
      font-size: 24px;
      font-weight: bold;
      cursor: pointer;
    }
    
    /* Responsive adjustments for modal */
    @media (max-height: 600px) {
      .modal-content {
        margin: 1% auto;
        padding: 15px;
        max-height: 95vh;
      }
      
      /* Compact card styling for small screens */
      .sucursal-card, .sala-card, .especialidad-card {
        padding: 12px;
        gap: 8px;
      }
      
      .sucursal-cards, .sala-cards, .especialidad-cards {
        max-height: 200px;
        gap: 8px;
      }
      
      .selector-label {
        margin-bottom: 8px;
        font-size: 0.9rem;
      }
      
      .sucursal-selector, .sala-selector, .especialidad-selector {
        margin-bottom: 15px;
      }
    }
    
    @media (max-width: 768px) {
      .modal-content {
        width: 98%;
        margin: 1% auto;
        padding: 15px;
      }
      
      /* Compact card styling for mobile */
      .sucursal-card, .sala-card, .especialidad-card {
        padding: 12px;
        gap: 8px;
      }
      
      .sucursal-cards, .sala-cards, .especialidad-cards {
        max-height: 200px;
        gap: 8px;
      }
      
      .selector-label {
        margin-bottom: 8px;
        font-size: 0.9rem;
      }
      
      .sucursal-selector, .sala-selector, .especialidad-selector {
        margin-bottom: 15px;
      }
    }
    
    /* Estilos para la información del turno */
    .turn-info-display {
      background: linear-gradient(135deg, #3B82F6, #1D4ED8);
      border-radius: 0.75rem;
      box-shadow: 0 10px 25px rgba(59, 130, 246, 0.3);
      border: 1px solid rgba(255, 255, 255, 0.1);
    }
    
    .turn-info-display h4 {
      color: #ffffff;
      font-weight: 600;
      margin-bottom: 1rem;
    }
    
    .turn-info-display .info-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 0.5rem 0;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }
    
    .turn-info-display .info-row:last-child {
      border-bottom: none;
    }
    
    .turn-info-display .info-label {
      color: rgba(255, 255, 255, 0.9);
      font-weight: 500;
    }
    
    .turn-info-display .info-value {
      color: #ffffff;
      font-weight: 700;
      font-size: 1.1rem;
    }
    
    /* Estilos para la información del turno dentro del modal */
    .turn-info-container {
      padding: 20px;
    }
    
    .turn-info-grid {
      display: grid;
      gap: 20px;
      margin: 20px 0;
    }
    
    .turn-info-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 15px;
      background: linear-gradient(135deg, #f8f9ff, #e6ecf9);
      border-radius: 10px;
      border: 1px solid #e0e7ff;
    }
    
    .turn-info-label {
      font-weight: 600;
      color: #374151;
      font-size: 0.95rem;
    }
    
    .turn-info-value {
      font-weight: 700;
      color: #863DFF;
      font-size: 1.1rem;
      text-align: right;
    }
    
    @media (max-width: 768px) {
      .turn-info-item {
        flex-direction: column;
        align-items: flex-start;
        gap: 8px;
      }
      
      .turn-info-value {
        text-align: left;
        width: 100%;
      }
    }
    
    /* Estilos para el contenedor de errores */
    .error-container {
      text-align: center;
      padding: 20px;
    }
    
    .error-icon {
      margin-bottom: 20px;
    }
    
    .error-message {
      color: #6c757d;
      font-size: 1rem;
      line-height: 1.5;
    }
    
    .card.ad-card {
      border-radius: 1.2rem;
      box-shadow: 0 4px 18px rgba(0,0,0,0.08);
      transition: transform 0.18s, box-shadow 0.18s;
      min-width: 210px;
      min-height: 380px;
      display: flex;
      flex-direction: column;
      justify-content: stretch;
      height: 100%;
    }
    .card.ad-card:hover {
      transform: translateY(-4px) scale(1.025);
      box-shadow: 0 8px 32px rgba(0,19,145,0.17);
    }
    .card-img-top-holder {
      width: 100%;
      height: 180px;
      display: flex;
      align-items: center;
      justify-content: center;
      overflow: hidden;
      background: #fff8f8;
      border-top-left-radius: 1.2rem;
      border-top-right-radius: 1.2rem;
    }
    .card-img-top-holder img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      object-position: center;
      transition: transform 0.3s;
    }
    .ad-card .card-body {
      display: flex;
      flex-direction: column;
      justify-content: flex-start;
      height: 100%;
      padding-bottom: 1.5rem;
    }
    .ad-card .card-title {
      font-weight: 700;
      color: var(--numia-azul);
      font-size: 1.25rem;
      margin-bottom: .25rem;
      margin-top: 1rem;
      min-height: 3rem;
      display: flex;
      align-items: center;
      justify-content: center;
      text-align: center;
    }
    .ad-card .card-text {
      font-size: 1.01rem;
      color: #2d2d2d;
      font-weight: 500;
      opacity: 0.88;
      margin-bottom: 1.1rem;
      min-height: 56px;
      text-align: center;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .carousel-item img {
      object-fit: cover;
      width: 100%;
      height: 340px;
      border-radius: 0.7rem;
    }
    @media (max-width: 991px) {
      .main-cards .col-lg-3 {
        flex: 0 0 50%;
        max-width: 50%;
        margin-bottom: 1rem;
      }
      .carousel-item img {
        height: 180px;
      }
    }
    @media (max-width: 767px) {
      .main-cards .col-lg-3 {
        flex: 0 0 100%;
        max-width: 100%;
      }
      .carousel-item img {
        height: 140px;
      }
      .card-img-top-holder {
        height: 140px;
      }
      .ad-card .card-title { font-size: 1.08rem; }
    }

    /* --- Sección de Planes/Coberturas (antes Divisas/Tasas) --- */
    .rates-section {
      display: flex;
      gap: 2.2rem;
      align-items: stretch;
      margin: 36px 0 0 0;
      width: 100%;
      flex-wrap: wrap;
    }
    .rates-col-table {
      background: #fff;
      border-radius: 1.1rem;
      box-shadow: 0 2px 12px rgba(0,0,0,0.07);
      padding: 2.1rem 1.6rem 1.6rem 1.7rem;
      min-width: 340px;
      flex: 2 1 540px;
      max-width: 1000px;
      display: flex;
      flex-direction: column;
      justify-content: flex-start;
    }
    .rates-col-side {
      background: #fff;
      border-radius: 1.1rem;
      box-shadow: 0 2px 12px rgba(0,0,0,0.07);
      padding: 2.1rem 1.6rem 1.6rem 1.7rem;
      min-width: 220px;
      flex: 1 1 320px;
      max-width: 420px;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: flex-start;
    }
    .rates-col-side .bi {
      font-size: 2.6rem;
      color: var(--numia-azul);
      margin-bottom: .7rem;
    }
    .rates-col-side h5 {
      color: var(--numia-azul);
      font-weight: 700;
      margin-bottom: .5rem;
      font-size: 1.2rem;
    }
    .rates-col-side p {
      color: #444;
      font-size: 1.07rem;
      font-weight: 500;
      margin-bottom: 1.2rem;
      opacity: .93;
    }
    .rates-col-side .btn {
      background: var(--numia-azul);
      border: none;
      color: #fff;
      font-weight: 700;
      border-radius: 24px;
      padding: 0.7rem 2.1rem;
      font-size: 1.07rem;
      box-shadow: 0 2px 7px rgba(0,19,145,0.06);
      transition: background 0.18s;
    }
    .rates-col-side .btn:hover {
      background: #000d73;
      color: #fff;
    }

    /* --- Botones de pestañas Divisas/Tasas --- */
    .rates-tab-btn {
      padding: .7rem 0;
      border: none;
      border-radius: 9px;
      font-weight: bold;
      font-size: 1.1rem;
      background: #fff;
      color: var(--numia-azul);
      margin-bottom: 0;
      transition: background .16s, color .16s;
      cursor: pointer;
      box-shadow: none;
      outline: none;
      border: 2px solid #d1d9f9; /* borde muy claro */
      min-width: 70px;
    }
    .rates-tab-btn.active,
    .rates-tab-btn:focus {
      background: var(--numia-azul);
      color: #fff;
      border: 2px solid var(--numia-azul);
    }

    /* --- Tabla de tasas/divisas --- */
    .rates-table {
      width: 100%;
      border-collapse: separate;
      border-spacing: 0;
      background: #fff;
      border-radius: 0.8rem;
      overflow: hidden;
      margin-top: 0.7rem;
    }
    .rates-table th,
    .rates-table td {
      padding: 12px 18px;
      font-size: 1.04rem;
      text-align: left;
    }
    .rates-table th {
      color: var(--numia-azul);
      background: var(--numia-azul-claro);
      border: none;
      font-size: 1.08rem;
      font-weight: 700;
      text-align: center;
      letter-spacing: 0.02em;
    }
    .rates-table tr:not(:last-child) {
      border-bottom: 1px solid #cde0f8;
    }
    .rates-table tr:nth-child(2) {
      background: var(--numia-azul-claro);
    }
    .rates-table tr:nth-child(3) {
      background: var(--numia-azul-muy-claro);
    }
    .rates-table td {
      color: #222;
      font-weight: 500;
      text-align: center;
      vertical-align: middle;
    }
    .rates-table td:first-child,
    .rates-table th:first-child {
      text-align: left;
    }

    @media (max-width: 1300px) {
      .rates-col-table {
        min-width: 0;
        flex-basis: 400px;
      }
      .rates-col-side {
        min-width: 0;
      }
    }
    @media (max-width: 991px) {
      .rates-section {
        flex-direction: column;
        gap: 1.4rem;
      }
      .rates-col-table,
      .rates-col-side {
        min-width: 0;
        max-width: 100%;
      }
      .rates-col-side {
        align-items: flex-start;
        padding-top: 1.2rem;
      }
    }

    /* --- Estilos específicos para botones y elementos que antes eran 'rojos' --- */
    /* Creamos una clase para forzar que btn-primary use nuestro azul */
    .btn-primary {
      background-color: var(--numia-azul) !important;
      border-color: var(--numia-azul) !important;
    }
    .btn-primary:hover {
      background-color: #000d73 !important;
      border-color: #000d73 !important;
    }
    .btn-outline-primary {
      color: var(--numia-azul) !important;
      border-color: var(--numia-azul) !important;
    }
    .btn-outline-primary:hover {
      background-color: var(--numia-azul) !important;
      color: #fff !important;
    }

    /* Cambiamos el icono de maximizar del chat para que destaque sobre azul */
    #max-chat {
      background: var(--numia-azul) !important;
    }
    #open-chat {
      background: var(--numia-azul) !important;
    }
    
    /* ======== ESTILOS PARA EL SIMULADOR DE SEGUROS DE AUTO ======== */
    .simulador-container {
      margin-bottom: 1rem;
    }
    
    .paso-simulador {
      text-align: center;
    }
    
    .paso-simulador h6 {
      color: var(--numia-azul);
      font-weight: 600;
      font-size: 0.9rem;
      margin-bottom: 1rem;
    }
    
    .paso-simulador .btn {
      font-size: 0.85rem;
      padding: 0.5rem 0.75rem;
      border-radius: 0.5rem;
      transition: all 0.2s ease;
    }
    
    .paso-simulador .btn:hover {
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(134, 61, 255, 0.2);
    }
    
    .resultado-cotizacion {
      border: 2px solid #e0e7ff;
      background: linear-gradient(135deg, #f8f9ff, #e6ecf9);
    }
    
    .cotizacion-detalle p {
      font-size: 0.85rem;
      margin-bottom: 0.25rem;
    }
    
    .cotizacion-detalle strong {
      color: var(--numia-azul);
    }
    
    .btn-link {
      color: var(--numia-azul);
      text-decoration: none;
      font-size: 0.8rem;
    }
    
    .btn-link:hover {
      color: #000d73;
      text-decoration: underline;
    }
    
    /* ======== ESTILOS PARA VIDEOLAMADA ======== */
    .video-call-btn {
      background: linear-gradient(135deg, #863DFF, #6B46C1);
      color: white;
      border: none;
      padding: 12px 24px;
      border-radius: 25px;
      font-weight: 600;
      font-size: 1rem;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 4px 15px rgba(134, 61, 255, 0.3);
      margin: 10px 0;
    }
    
    .video-call-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(134, 61, 255, 0.4);
      background: linear-gradient(135deg, #6B46C1, #5A3D9E);
    }
    
    .video-call-container {
      text-align: center;
      padding: 20px;
    }
    
    .video-call-header {
      margin-bottom: 20px;
    }
    
    .video-call-title {
      color: #863DFF;
      font-size: 1.5rem;
      font-weight: 700;
      margin-bottom: 8px;
    }
    
    .video-call-subtitle {
      color: #666;
      font-size: 1rem;
    }
    
    .video-call-frame-container {
      margin: 20px 0;
      border-radius: 12px;
      overflow: hidden;
      box-shadow: 0 4px 20px rgba(0,0,0,0.1);
    }
    
    .video-call-iframe {
      width: 100%;
      height: 400px;
      border: none;
    }
    
    .video-call-actions {
      display: flex;
      gap: 15px;
      justify-content: center;
      margin-top: 20px;
    }
    
    .video-call-back-btn,
    .video-call-close-btn {
      padding: 10px 20px;
      border: none;
      border-radius: 8px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s ease;
    }
    
    .video-call-back-btn {
      background-color: #6c757d;
      color: white;
    }
    
    .video-call-back-btn:hover {
      background-color: #5a6268;
    }
    
    .video-call-close-btn {
      background-color: #863DFF;
      color: white;
    }
    
    .video-call-close-btn:hover {
      background-color: #6B46C1;
    }

    /* ======== ESTILOS MODERNOS PARA EL MODAL (igual que indexSalud) ======== */
    
    /* Modal más angosto */
    #formModal .modal-content {
      max-width: 450px !important;
      width: 90% !important;
      margin: 2% auto !important;
      padding: 25px !important;
    }
    
    /* Layout de formulario en dos columnas */
    #formModal .form-row {
      display: flex;
      gap: 1rem;
      margin-bottom: 1.5rem;
    }
    
    #formModal .form-col {
      flex: 1;
      min-width: 0;
    }
    
    #formModal .form-col-full {
      width: 100%;
      margin-bottom: 1.5rem;
    }
    
    /* Estilos para las etiquetas del formulario */
    #formModal label {
      display: block;
      margin-bottom: 0.75rem;
      font-weight: 600;
      font-size: 0.9rem;
      color: #374151;
      text-transform: none;
      letter-spacing: 0.025em;
      font-family: 'Hanken Grotesk', system-ui, sans-serif !important;
    }
    
    /* Campos de entrada modernos */
    #formModal input[type="text"],
    #formModal input[type="email"],
    #formModal input[type="tel"] {
      border: 1px solid #e5e7eb !important;
      border-radius: 0.5rem !important;
      padding: 0.75rem 1rem !important;
      width: 100% !important;
      max-width: 100% !important;
      font-size: 0.95rem !important;
      transition: all 0.2s ease !important;
      background-color: #ffffff !important;
      color: #374151 !important;
      font-family: 'Hanken Grotesk', system-ui, sans-serif !important;
    }
    
    #formModal input[type="text"]:focus,
    #formModal input[type="email"]:focus,
    #formModal input[type="tel"]:focus {
      border-color: #863DFF !important;
      box-shadow: 0 0 0 3px rgba(134, 61, 255, 0.1) !important;
      outline: none !important;
      background-color: #ffffff !important;
      transform: translateY(-1px) !important;
    }
    
    /* Botón primario moderno */
    #formModal .btn-primary {
      background-color: #863DFF !important;
      color: white !important;
      font-weight: 600 !important;
      padding: 0.875rem 1.5rem !important;
      border-radius: 0.5rem !important;
      transition: all 0.2s ease !important;
      font-size: 0.9rem !important;
      text-transform: none !important;
      letter-spacing: 0.025em !important;
      border: none !important;
      display: inline-flex !important;
      align-items: center !important;
      gap: 0.5rem !important;
      font-family: 'Hanken Grotesk', system-ui, sans-serif !important;
    }
    
    #formModal .btn-primary:hover {
      background-color: #7c3aed !important;
      transform: translateY(-2px) !important;
      box-shadow: 0 8px 25px rgba(134, 61, 255, 0.3) !important;
    }
    
    /* Botón secundario moderno */
    #formModal .btn-secondary {
      background-color: #ffffff !important;
      color: #374151 !important;
      font-weight: 500 !important;
      padding: 0.875rem 1.5rem !important;
      border-radius: 0.5rem !important;
      transition: all 0.2s ease !important;
      font-size: 0.9rem !important;
      text-transform: none !important;
      letter-spacing: 0.025em !important;
      border: 1px solid #e5e7eb !important;
      display: inline-flex !important;
      align-items: center !important;
      gap: 0.5rem !important;
      font-family: 'Hanken Grotesk', system-ui, sans-serif !important;
    }
    
    #formModal .btn-secondary:hover {
      background-color: #f9fafb !important;
      border-color: #d1d5db !important;
      transform: translateY(-1px) !important;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1) !important;
    }
    
    /* Contenedor de botones */
    #formModal .form-actions {
      display: flex;
      justify-content: flex-end;
      gap: 1rem;
      margin-top: 2rem;
      padding-top: 1.5rem;
      border-top: 1px solid #f3f4f6;
    }
    
    /* Texto explicativo del formulario */
    #formModal .form-instructions {
      margin: 1.5rem 0;
      padding: 1rem;
      background-color: #f8fafc;
      border-radius: 0.5rem;
      border-left: 4px solid #863DFF;
    }
    
    #formModal .form-instructions p {
      margin: 0;
      font-size: 0.9rem;
      color: #6b7280;
      line-height: 1.5;
      font-family: 'Hanken Grotesk', system-ui, sans-serif;
    }
    
    /* Responsive para móviles */
    @media (max-width: 768px) {
      #formModal .form-row {
        flex-direction: column;
        gap: 0;
      }
      
      #formModal .form-actions {
        flex-direction: column;
        gap: 0.75rem;
      }
      
      #formModal .btn-primary,
      #formModal .btn-secondary {
        width: 100%;
        justify-content: center;
      }
    }

  </style>
</head>
<body class="d-flex flex-column min-vh-100">

  <!-- Encabezado con logos -->
  <header class="bg-white shadow-sm py-2 mb-0">
    <div class="container">
      <div class="d-flex justify-content-between align-items-center">
        <a href="index.html" class="d-block">
          <img src="images/numia.png" alt="Numia Insurance Logo" class="img-fluid" style="max-height: 88px;" />
        </a>
        <div class="d-flex align-items-center">
          <a href="broker.html" class="btn btn-outline-primary btn-sm me-3">
            <i class="bi bi-briefcase me-2"></i>Área Broker
          </a>
        </div>
      </div>
      <p class="lead mt-2 mb-0 text-dark text-start" style="font-size:1rem;">
        Protección inteligente para tu vida, salud, auto y hogar — con la tecnología de Numia
      </p>
    </div>
  </header>

  <!-- NAVBAR principal -->
  <nav class="navbar navbar-expand-lg navbar-light bg-white shadow-sm border-bottom" style="z-index:1050;">
    <div class="container">
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarMain" aria-controls="navbarMain" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse justify-content-center" id="navbarMain">
        <ul class="navbar-nav mb-2 mb-lg-0">
          <li class="nav-item dropdown px-2">
            <a class="nav-link dropdown-toggle fw-semibold" href="#" id="segurosProductos" role="button" data-bs-toggle="dropdown" aria-expanded="false">
              <i class="bi bi-shield-check me-1"></i>Seguros
            </a>
            <ul class="dropdown-menu" aria-labelledby="segurosProductos">
              <li><a class="dropdown-item" href="#"><i class="bi bi-truck-front me-2"></i>Auto</a></li>
              <li><a class="dropdown-item" href="#"><i class="bi bi-heart-pulse me-2"></i>Salud</a></li>
              <li><a class="dropdown-item" href="#"><i class="bi bi-person-heart me-2"></i>Vida</a></li>
              <li><a class="dropdown-item" href="#"><i class="bi bi-house-heart me-2"></i>Hogar</a></li>
            </ul>
          </li>
          <li class="nav-item dropdown px-2">
            <a class="nav-link dropdown-toggle fw-semibold" href="#" id="cotizaDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
              <i class="bi bi-calculator me-1"></i>Cotiza
            </a>
            <ul class="dropdown-menu" aria-labelledby="cotizaDropdown">
              <li><a class="dropdown-item" href="#"><i class="bi bi-speedometer2 me-2"></i>Seguro de Auto</a></li>
              <li><a class="dropdown-item" href="#"><i class="bi bi-heart-pulse me-2"></i>Gastos Médicos</a></li>
              <li><a class="dropdown-item" href="#"><i class="bi bi-person-vcard me-2"></i>Vida</a></li>
              <li><a class="dropdown-item" href="#"><i class="bi bi-house-door me-2"></i>Hogar</a></li>
            </ul>
          </li>
          <li class="nav-item dropdown px-2">
            <a class="nav-link dropdown-toggle fw-semibold" href="#" id="siniestrosDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
              <i class="bi bi-exclamation-triangle me-1"></i>Siniestros
            </a>
            <ul class="dropdown-menu" aria-labelledby="siniestrosDropdown">
              <li><a class="dropdown-item" href="#"><i class="bi bi-telephone-inbound me-2"></i>Reportar siniestro</a></li>
              <li><a class="dropdown-item" href="#"><i class="bi bi-clock-history me-2"></i>Seguimiento</a></li>
              <li><a class="dropdown-item" href="#"><i class="bi bi-geo-alt me-2"></i>Talleres y clínicas</a></li>
            </ul>
          </li>
          <li class="nav-item dropdown px-2">
            <a class="nav-link dropdown-toggle fw-semibold" href="#" id="asistenciaDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
              <i class="bi bi-headset me-1"></i>Asistencias
            </a>
            <ul class="dropdown-menu" aria-labelledby="asistenciaDropdown">
              <li><a class="dropdown-item" href="#"><i class="bi bi-wrench-adjustable me-2"></i>Vial 24/7</a></li>
              <li><a class="dropdown-item" href="#"><i class="bi bi-thermometer-half me-2"></i>Telemedicina</a></li>
              <li><a class="dropdown-item" href="#"><i class="bi bi-house-add me-2"></i>Hogar</a></li>
            </ul>
          </li>
          <li class="nav-item dropdown px-2">
            <a class="nav-link dropdown-toggle fw-semibold" href="#" id="miCuentaDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
              <i class="bi bi-person-circle me-1"></i>Mi cuenta
            </a>
            <ul class="dropdown-menu" aria-labelledby="miCuentaDropdown">
              <li><a class="dropdown-item" href="#"><i class="bi bi-file-earmark-text me-2"></i>Mis pólizas</a></li>
              <li><a class="dropdown-item" href="#"><i class="bi bi-receipt me-2"></i>Pagos y renovaciones</a></li>
              <li><a class="dropdown-item" href="#"><i class="bi bi-chat-dots me-2"></i>Contactar asesor</a></li>
            </ul>
          </li>
        </ul>
      </div>
    </div>
  </nav>

  <!-- Carrusel -->
  <div class="container mb-4">
    <div id="carouselMain" class="carousel slide shadow-sm rounded-3" data-bs-ride="carousel">
      <div class="carousel-inner">
        <div class="carousel-item active">
          <img src="images/carrusel1.png" class="d-block w-100" alt="Promo seguros 1">
          <div class="carousel-caption d-none d-md-block">
            <h5 class="fw-bold display-6" style="text-shadow: 0 2px 12px rgba(0,0,0,0.36)">Protección total</h5>
            <p class="fs-4">Asegura auto, salud y vida con descuentos por multipóliza</p>
            <a href="#" class="btn btn-primary btn-lg rounded-pill mt-2 px-4 fw-bold">Conoce más</a>
          </div>
        </div>
        <div class="carousel-item">
          <img src="images/carrusel2.png" class="d-block w-100" alt="Promo seguros 2">
          <div class="carousel-caption d-none d-md-block">
            <h5 class="fw-bold display-6">Gestión 100% digital</h5>
            <p class="fs-4">Cotiza, compra y da seguimiento a tus siniestros 24/7</p>
            <a href="#" class="btn btn-outline-light btn-lg rounded-pill mt-2 px-4 fw-bold">Regístrate aquí</a>
          </div>
        </div>
        <div class="carousel-item">
          <img src="images/carrusel3.jpg" class="d-block w-100" alt="Promo seguros 3">
          <div class="carousel-caption d-none d-md-block">
            <h5 class="fw-bold display-6">Salud y Vida</h5>
            <p class="fs-4">Planes flexibles con coberturas a tu medida</p>
            <a href="#" class="btn btn-primary btn-lg rounded-pill mt-2 px-4 fw-bold">Cotiza ahora</a>
          </div>
        </div>
      </div>
      <button class="carousel-control-prev" type="button" data-bs-target="#carouselMain" data-bs-slide="prev">
        <span class="carousel-control-prev-icon bg-dark rounded-circle" aria-hidden="true"></span>
        <span class="visually-hidden">Anterior</span>
      </button>
      <button class="carousel-control-next" type="button" data-bs-target="#carouselMain" data-bs-slide="next">
        <span class="carousel-control-next-icon bg-dark rounded-circle" aria-hidden="true"></span>
        <span class="visually-hidden">Siguiente</span>
      </button>
      <div class="carousel-indicators">
        <button type="button" data-bs-target="#carouselMain" data-bs-slide-to="0" class="active" aria-current="true" aria-label="Slide 1"></button>
        <button type="button" data-bs-target="#carouselMain" data-bs-slide-to="1" aria-label="Slide 2"></button>
        <button type="button" data-bs-target="#carouselMain" data-bs-slide-to="2" aria-label="Slide 3"></button>
      </div>
    </div>
  </div>

  <!-- TARJETAS -->
  <main class="container mb-5">
    <div class="row g-4 justify-content-center main-cards">
      <div class="col-lg-3 col-md-6">
        <div class="card ad-card h-100 text-center">
          <div class="card-img-top-holder">
            <img src="images/Tarjeta de credito.jpg" alt="Asesor de Seguros">
          </div>
          <div class="card-body">
            <h5 class="card-title">Agenda con un asesor</h5>
            <p class="card-text">Planifica una cita para obtener asesoría personalizada para elegir tu póliza ideal en minutos.</p>
            <button class="btn btn-primary rounded-pill px-4 mt-2 fw-bold" onclick="cargarCombosDesdeAPI()">Agendar</button>
          </div>
        </div>
      </div>
      <div class="col-lg-3 col-md-6">
        <div class="card ad-card h-100 text-center">
          <div class="card-img-top-holder">
            <img src="images/Apertura de cuenta.png" alt="Cotizador">
          </div>
          <div class="card-body">
            <h5 class="card-title">Cotiza tu seguro</h5>
            
            <!-- Simulador de seguros de auto -->
            <div id="simuladorAuto" class="simulador-container">
              <!-- Paso 1: Selección de tipo de vehículo -->
              <div id="paso1" class="paso-simulador">
                <h6 class="mb-3">¿Qué tipo de vehículo tienes?</h6>
                <div class="d-grid gap-2">
                  <button class="btn btn-outline-primary btn-sm" onclick="seleccionarTipoVehiculo('auto')">
                    <i class="bi bi-car-front me-2"></i>Auto
                  </button>
                  <button class="btn btn-outline-primary btn-sm" onclick="seleccionarTipoVehiculo('camioneta')">
                    <i class="bi bi-truck me-2"></i>Camioneta
                  </button>
                  <button class="btn btn-outline-primary btn-sm" onclick="seleccionarTipoVehiculo('moto')">
                    <i class="bi bi-bicycle me-2"></i>Moto
                  </button>
                </div>
              </div>
              
              <!-- Paso 2: Selección de cobertura -->
              <div id="paso2" class="paso-simulador" style="display: none;">
                <h6 class="mb-3">Selecciona tu cobertura</h6>
                <div class="d-grid gap-2">
                  <button class="btn btn-outline-primary btn-sm" onclick="seleccionarCobertura('basica')">
                    <i class="bi bi-shield-check me-2"></i>Básica
                    <small class="d-block">Desde $299/mes</small>
                  </button>
                  <button class="btn btn-outline-primary btn-sm" onclick="seleccionarCobertura('completa')">
                    <i class="bi bi-shield-fill me-2"></i>Completa
                    <small class="d-block">Desde $450/mes</small>
                  </button>
                  <button class="btn btn-outline-primary btn-sm" onclick="seleccionarCobertura('premium')">
                    <i class="bi bi-star-fill me-2"></i>Premium
                    <small class="d-block">Desde $650/mes</small>
                  </button>
                </div>
                <button class="btn btn-link btn-sm mt-2" onclick="volverPaso1()">
                  <i class="bi bi-arrow-left me-1"></i>Volver
                </button>
              </div>
              
              <!-- Resultado del simulador -->
              <div id="resultadoSimulador" class="paso-simulador" style="display: none;">
                <div class="resultado-cotizacion p-3 bg-light rounded">
                  <h6 class="text-success mb-2">
                    <i class="bi bi-check-circle me-2"></i>Cotización lista
                  </h6>
                  <div class="cotizacion-detalle">
                    <p class="mb-1"><strong>Vehículo:</strong> <span id="tipoVehiculoSeleccionado"></span></p>
                    <p class="mb-1"><strong>Cobertura:</strong> <span id="coberturaSeleccionada"></span></p>
                    <p class="mb-2"><strong>Prima mensual:</strong> <span id="primaMensual" class="text-primary fw-bold"></span></p>
                  </div>
                </div>
                <button class="btn btn-link btn-sm mt-2" onclick="reiniciarSimulador()">
                  <i class="bi bi-arrow-clockwise me-1"></i>Nueva cotización
                </button>
              </div>
            </div>
            
            <!-- Botón para hablar con asesor -->
            <div class="mt-3">
              <button class="btn btn-primary rounded-pill px-4" onclick="showFormModal('13946')">
                <i class="bi bi-headset me-2"></i>Hablar con un asesor
              </button>
            </div>
          </div>
        </div>
      </div>
      <div class="col-lg-3 col-md-6">
        <div class="card ad-card h-100 text-center">
          <div class="card-img-top-holder">
            <img src="images/segurodeauto.png" alt="Auto">
          </div>
          <div class="card-body">
            <h5 class="card-title">Seguro de Auto</h5>
            <p class="card-text">Obtén asesoría presenial sobre coberturas y precios.</p>
            <button class="btn btn-primary rounded-pill px-4 mt-2 fw-bold" onclick="showFormModal('13945')">Reservar turno</button>
          </div>
        </div>
      </div>
      <div class="col-lg-3 col-md-6">
        <div class="card ad-card h-100 text-center">
          <div class="card-img-top-holder">
            <img src="images/Seguro vida.jpg" alt="Salud y Vida">
          </div>
          <div class="card-body">
            <h5 class="card-title">Salud y Vida</h5>
            <p class="card-text">Protección para ti y tu familia con acceso a telemedicina.</p>
            <button class="btn btn-outline-primary rounded-pill px-4 mt-2 fw-bold" disabled>Conoce más</button>
          </div>
        </div>
      </div>
    </div>

    <!-- SECCIÓN: PLANES y COBERTURAS (sustituye divisas/tasas e inversiones) -->
    <div class="rates-section mt-5 mb-4">
      <div class="rates-col-table">
        <div class="d-flex gap-3 mb-2">
          <button class="rates-tab-btn active" id="tabDivisas" onclick="showRatesTab('divisas')">Planes</button>
          <button class="rates-tab-btn" id="tabTasas" onclick="showRatesTab('tasas')">Coberturas</button>
        </div>
        <!-- Tabla de PLANES -->
        <table class="rates-table" id="tablaDivisas">
          <thead>
            <tr>
              <th>Plan</th>
              <th>Prima mensual desde</th>
              <th>Deducible</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>Auto Esencial</td>
              <td>$299 MXN</td>
              <td>$6,000 MXN</td>
            </tr>
            <tr>
              <td>Salud Plus</td>
              <td>$750 MXN</td>
              <td>$3,500 MXN</td>
            </tr>
            <tr>
              <td>Vida Integral</td>
              <td>$420 MXN</td>
              <td>Sin deducible</td>
            </tr>
          </tbody>
        </table>
        <!-- Tabla de COBERTURAS -->
        <table class="rates-table" id="tablaTasas" style="display:none;">
          <thead>
            <tr>
              <th>Cobertura</th>
              <th>Auto</th>
              <th>Salud</th>
              <th>Vida</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>Daños a terceros</td>
              <td>✔</td><td>—</td><td>—</td>
            </tr>
            <tr>
              <td>Robo total</td>
              <td>✔</td><td>—</td><td>—</td>
            </tr>
            <tr>
              <td>Gastos médicos mayores</td>
              <td>—</td><td>✔</td><td>—</td>
            </tr>
            <tr>
              <td>Indemnización por fallecimiento</td>
              <td>—</td><td>—</td><td>✔</td>
            </tr>
          </tbody>
        </table>
      </div>
      <div class="rates-col-side">
        <i class="bi bi-file-earmark-text"></i>
        <h5 class="mb-1" style="font-weight:700;">Tus pólizas Numia</h5>
        <p class="mb-2">
          <strong>Auto:</strong> $389/mes · <span class="text-muted">Renueva 15/09</span><br>
          <strong>Salud:</strong> $820/mes · <span class="text-muted">Renueva 21/11</span>
        </p>
        <p class="mb-3">
          <span class="chip"><i class="bi bi-truck-front"></i> Auto</span>
          <span class="chip"><i class="bi bi-heart-pulse"></i> Salud</span>
          <span class="chip"><i class="bi bi-person-heart"></i> Vida</span>
          <span class="chip"><i class="bi bi-house-heart"></i> Hogar</span>
        </p>
        <button class="btn" disabled>Gestionar pólizas</button>
      </div>
    </div>
  </main>

  <!-- Pie de página -->
  <footer class="bg-light text-center py-3 mt-auto border-top">
    <small>&copy; NumiaInsurance. Todos los derechos reservados.</small>
  </footer>

  <!-- ===================== MODAL DE AGENDAR CITA MÉDICA (replicado de indexSalud) ===================== -->
  <div id="popupModal" class="modal">
    <div class="modal-content">
      <span class="close" onclick="document.getElementById('popupModal').style.display='none'">&times;</span>
      <div>
        <h3 class='titulo'>Seleccione una agenda</h3>
      </div>
      <div id="formularioInicial">
        <div class="selectors-container">
          <div class="especialidad-selector">
            <label class="selector-label">Selecciona una especialidad:</label>
            <div id="especialidadCombo" class="especialidad-cards">
              <div class="especialidad-card" data-value="seguro-auto">
                <i class="bi bi-car-front especialidad-icon"></i>
                <div class="especialidad-info">
                  <div class="especialidad-name">Seguro Automotor</div>
                  <div class="especialidad-status">Disponible</div>
                </div>
              </div>
              <div class="especialidad-card" data-value="seguro-hogar">
                <i class="bi bi-house-heart especialidad-icon"></i>
                <div class="especialidad-info">
                  <div class="especialidad-name">Seguro de Hogar</div>
                  <div class="especialidad-status">Disponible</div>
                </div>
              </div>
        
              <div class="especialidad-card" data-value="seguro-vida">
                <i class="bi bi-person-heart especialidad-icon"></i>
                <div class="especialidad-info">
                  <div class="especialidad-name">Seguro de Vida</div>
                  <div class="especialidad-status">Disponible</div>
                </div>
              </div>
            </div>
            <input type="hidden" id="especialidadComboValue" required>
          </div>
          
          <div class="sucursal-selector">
            <label class="selector-label">Selecciona una sucursal:</label>
            <div id="sucuCombo" class="sucursal-cards">
              <div class="loading-card">
                <i class="bi bi-arrow-clockwise spin"></i>
                <span>Cargando sucursales...</span>
              </div>
            </div>
            <input type="hidden" id="sucuComboValue" required>
          </div>
          
          <div class="sala-selector">
            <label class="selector-label">Selecciona una agenda:</label>
            <div id="salaCombo" class="sala-cards">
              <div class="loading-card">
                <i class="bi bi-arrow-clockwise spin"></i>
                <span>Selecciona especialidad y sucursal para ver las agendas disponibles</span>
              </div>
            </div>
            <input type="hidden" id="salaComboValue" required>
          </div>
        </div>
      </div>

      <div id="bloqueFecha" style="display: none;">
        <label for="fecha">Seleccione una fecha: </label>
        <input type="text" id="fecha" placeholder="Elige una fecha" />
      </div>
    
      <div id="resultados" class="flex flex-wrap gap-3 justify-center my-4"></div>
      <div id="formularioDatos" style="display: none;"></div>
      <div id="final"></div>
    </div>
  </div>

  <!-- Modal Form para reservar turno -->
  <div id="formModal" class="modal">
    <div class="modal-content">
      <span class="close" onclick="hideForm()">&times;</span>
      <h3 class="titulo" id="modalTitle">Reserva tu Turno</h3>
      <div id="serviceTypeIndicator" class="service-type-indicator hidden"></div>
      <div id="message" class="hidden p-4 rounded-lg mb-4"></div>

      <form id="reservaForm" class="space-y-4" onsubmit="return handleSubmit(event)">
        <!-- Primera fila: Nombre y Apellido -->
        <div class="form-row">
          <div class="form-col">
            <label>Nombre</label>
            <input type="text" name="firstName" required class="input-field" />
          </div>
          <div class="form-col">
            <label>Apellido</label>
            <input type="text" name="lastName" required class="input-field" />
          </div>
        </div>

        <!-- Segunda fila: DNI y Teléfono -->
        <div class="form-row">
          <div class="form-col">
            <label>DNI</label>
            <input type="text" name="dni" required class="input-field" />
          </div>
          <div class="form-col">
            <label>Teléfono</label>
            <input type="tel" name="phone" required class="input-field" />
          </div>
        </div>

        <!-- Tercera fila: Email (ancho completo) -->
        <div class="form-col-full">
          <label>Email</label>
          <input type="email" name="email" required class="input-field" />
        </div>

        <!-- Texto explicativo -->
        <div class="form-instructions">
          <p>Al continuar, te asignaremos un turno y verás una sala de espera. Cuando el agente esté listo, podrás iniciar una videollamada.</p>
        </div>

        <!-- Botones de acción -->
        <div class="form-actions">
          <button type="button" class="btn-secondary" onclick="hideForm()">Cancelar</button>
          <button type="button" class="btn-primary" id="submitBtn" onclick="reservarTurnoReal()">
            <i class="bi bi-check-lg"></i>
            Generar turno
          </button>
        </div>
      </form>
    </div>
  </div>
  <!-- =================== FIN MODAL DE AGENDAR CITA MÉDICA =================== -->



  <!-- Bootstrap JS Bundle -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

  <!-- 
    JavaScript para:
    1) Conmutar pestañas Planes / Coberturas (se reaprovecha la función)
    2) Controlar la apertura/maximización del chat
  -->
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      // Función de pestañas (reusa IDs existentes)
      function showRatesTab(tab) {
        const tabDivisas = document.getElementById('tabDivisas');
        const tabTasas = document.getElementById('tabTasas');
        const tablaDivisas = document.getElementById('tablaDivisas');
        const tablaTasas = document.getElementById('tablaTasas');
        if (tab === 'divisas') {
          tabDivisas.classList.add('active');
          tabTasas.classList.remove('active');
          tablaDivisas.style.display = '';
          tablaTasas.style.display = 'none';
        } else {
          tabDivisas.classList.remove('active');
          tabTasas.classList.add('active');
          tablaDivisas.style.display = 'none';
          tablaTasas.style.display = '';
        }
      }
      window.showRatesTab = showRatesTab;

      // Control de la burbuja de chat
      const iframe = document.getElementById('numia-chat-bubble');
      const btn = document.getElementById('max-chat');
      const openBtn = document.getElementById('open-chat');
      let maximized = false;

      openBtn.onclick = function() {
        iframe.style.display = 'block';
        btn.style.display = 'flex';
        openBtn.style.display = 'none';
      };
      btn.onclick = function() {
        if (!maximized) {
          iframe.style.width = '98vw';
          iframe.style.height = '94vh';
          iframe.style.bottom = '3vh';
          iframe.style.right = '1vw';
          iframe.style.boxShadow = 'none';
          btn.style.bottom = 'calc(94vh + 3vh + 12px)';
          btn.textContent = '🗗';
          maximized = true;
        } else {
          iframe.style.width = '370px';
          iframe.style.height = '550px';
          iframe.style.bottom = '24px';
          iframe.style.right = '24px';
          iframe.style.boxShadow = 'none';
          btn.style.bottom = '590px';
          btn.textContent = '⛶';
          maximized = false;
        }
      };
    });
  </script>

  <!-- ================== JS de la integración de citas (TOKEN actualizado) ================== -->
  <script>
    (function(){
      const API_TOKEN = 'VwJ3ACdnXWPdnjEwLxs0mKoRHvCU23tGLYryRiF1';
      const SVC_LIST   = 'https://citas2.debmedia.com/api/v2/reducedSchedules';
      const AVAIL_BASE = 'https://citas2.debmedia.com/api/v2/schedules';
      const APPT_URL   = 'https://citas2.debmedia.com/api/v2/appointments';

      // Elementos UI
      const modalEl = document.getElementById('modalCita');
      const modal = new bootstrap.Modal(modalEl);
      const btnPrimaryCards = document.querySelectorAll('.ad-card .btn.btn-primary');
      const alertBox = document.getElementById('citaAlert');
      const selSchedule = document.getElementById('citaSchedule');
      const selBranch   = document.getElementById('citaBranch');
      const inputFecha  = document.getElementById('citaFecha');
      const slotsWrap   = document.getElementById('citaSlots');
      const btnConfirm  = document.getElementById('citaConfirmar');

      const inFirst = document.getElementById('citaFirst');
      const inLast  = document.getElementById('citaLast');
      const inDni   = document.getElementById('citaDni');
      const inMail  = document.getElementById('citaMail');

      // Estado
      let schedules = [];
      let selectedSlot = null;

      // Habilitar el primer botón primario ("Agendar") para abrir el modal
      if (btnPrimaryCards && btnPrimaryCards.length) {
        const btnSolicitar = btnPrimaryCards[0];
        btnSolicitar.removeAttribute('disabled');
        btnSolicitar.addEventListener('click', async () => {
          resetForm();
          modal.show();
          await loadSchedules();
        });
      }

      // Utilidades
      const pad = n => String(n).padStart(2,'0');
      const ymd = (d) => `${d.getFullYear()}-${pad(d.getMonth()+1)}-${pad(d.getDate())}`;
      function isoFromZonedStart(zonedStartDate) { return new Date(zonedStartDate); }
      function setAlert(type, msg){
        alertBox.className = `alert alert-${type}`;
        alertBox.textContent = msg;
        alertBox.classList.remove('d-none');
      }
      function clearAlert(){ alertBox.className = 'alert d-none'; alertBox.textContent=''; }

      function resetForm(){
        clearAlert();
        selSchedule.innerHTML = `<option value="">Cargando...</option>`;
        selBranch.innerHTML   = `<option value="">Selecciona un ramo</option>`;
        selBranch.disabled = true;
        inputFecha.value = '';
        inputFecha.disabled = true;
        slotsWrap.innerHTML = '';
        selectedSlot = null;
        btnConfirm.disabled = true;
        inFirst.value = ''; inLast.value = ''; inDni.value = ''; inMail.value = '';
      }

      async function loadSchedules(){
        try{
          const res = await fetch(SVC_LIST, { headers: { 'x-api-token': API_TOKEN } });
          if(!res.ok) throw new Error(`No se pudieron obtener las agendas (${res.status})`);
          schedules = await res.json();

          selSchedule.innerHTML = `<option value="">Selecciona un ramo...</option>`;
          schedules.forEach(s => {
            selSchedule.insertAdjacentHTML('beforeend', `<option value="${s.id}">${s.name}</option>`);
          });

          const today = new Date();
          inputFecha.min = ymd(today);
          inputFecha.disabled = false;

          selSchedule.onchange = handleScheduleChange;
          selBranch.onchange = handleBranchOrDateChange;
          inputFecha.onchange = handleBranchOrDateChange;

        }catch(err){
          setAlert('danger', err.message);
        }
      }

      function handleScheduleChange(){
        const schedId = selSchedule.value;
        selBranch.innerHTML = `<option value="">Selecciona centro...</option>`;
        selBranch.disabled = true;
        slotsWrap.innerHTML = '';
        btnConfirm.disabled = true;

        if(!schedId){ return; }

        const sched = schedules.find(s => String(s.id) === String(schedId));
        if(!sched || !Array.isArray(sched.branches)) {
          setAlert('danger', 'Esta agenda no tiene centros asociados.');
          return;
        }
        const seen = new Set();
        sched.branches.forEach(b=>{
          if(!seen.has(b.id)){
            selBranch.insertAdjacentHTML('beforeend', `<option value="${b.id}">${b.name}</option>`);
            seen.add(b.id);
          }
        });
        selBranch.disabled = false;
        clearAlert();
      }

      async function handleBranchOrDateChange(){
        clearAlert();
        slotsWrap.innerHTML = '';
        selectedSlot = null;
        btnConfirm.disabled = true;

        const schedId = selSchedule.value;
        const branchId = selBranch.value;
        const dateStr  = inputFecha.value;

        if(!schedId || !branchId || !dateStr){ return; }

        try{
          const url = `${AVAIL_BASE}/${encodeURIComponent(schedId)}/branch/${encodeURIComponent(branchId)}/availability?strDate=${encodeURIComponent(dateStr)}`;
          const res = await fetch(url, { headers: { 'x-api-token': API_TOKEN }});
          if(!res.ok) throw new Error(`No se pudo obtener disponibilidad (${res.status})`);
          const data = await res.json();

          const slots = Array.isArray(data) ? data : (Array.isArray(data.slots) ? data.slots : []);
          if(slots.length === 0){
            setAlert('info','No hay horarios disponibles para la fecha seleccionada.');
            return;
          }

          const frag = document.createDocumentFragment();
          slots.forEach(slot=>{
            const hora = slot.zonedStartDate.substring(11,16);
            const btn = document.createElement('button');
            btn.type = 'button';
            btn.className = 'btn btn-light';
            btn.textContent = hora;
            btn.addEventListener('click', ()=>{
              [...slotsWrap.querySelectorAll('.btn')].forEach(b=>b.classList.remove('active'));
              btn.classList.add('active');
              const startDate = isoFromZonedStart(slot.zonedStartDate);
              const end = new Date(startDate.getTime() + (slot.defaultDuration||0) * 60000);
              selectedSlot = { startAt: slot.zonedStartDate, endAt: end };
              btnConfirm.disabled = false;
            });
            frag.appendChild(btn);
          });
          slotsWrap.appendChild(frag);

        }catch(err){
          setAlert('danger', err.message);
        }
      }

      btnConfirm.addEventListener('click', async ()=>{
        clearAlert();
        if(!selectedSlot){ setAlert('danger','Selecciona un horario primero.'); return; }
        const schedId = selSchedule.value;
        const branchId = selBranch.value;
        if(!schedId || !branchId){ setAlert('danger','Faltan ramo o centro.'); return; }
        if(!inFirst.value || !inLast.value || !inDni.value){
          setAlert('danger','Completa Nombre, Apellido y DNI.');
          return;
        }

        const startDate = new Date(selectedSlot.startAt);
        const endDate   = new Date(selectedSlot.endAt);
        const fmt = (d)=>{
          const off = -d.getTimezoneOffset();
          const sign = off >= 0 ? '+' : '-';
          const pad = n => String(n).padStart(2,'0');
          const hh = pad(Math.floor(Math.abs(off)/60));
          const mm = pad(Math.abs(off)%60);
          return `${d.getFullYear()}-${pad(d.getMonth()+1)}-${pad(d.getDate())}T${pad(d.getHours())}:${pad(d.getMinutes())}:00${sign}${hh}${mm}`;
        };

        const body = {
          branch:   { id: Number(branchId) },
          schedule: { id: Number(schedId) },
          startAt:  fmt(startDate),
          endAt:    fmt(endDate),
          customer: {
            firstName: inFirst.value,
            lastName:  inLast.value,
            dni:       Number(inDni.value||0),
            email:     inMail.value || undefined
          },
          reason: "Asesoría de Seguros"
        };

        btnConfirm.disabled = true;
        btnConfirm.textContent = 'Confirmando...';

        try{
          const res = await fetch(APPT_URL, {
            method: 'POST',
            headers: {
              'x-api-token': API_TOKEN,
              'Content-Type': 'application/json'
            },
            body: JSON.stringify(body)
          });
          const out = await res.json().catch(()=> ({}));
          if(!res.ok){
            throw new Error(out?.message || `Error al crear la cita (${res.status})`);
          }
          setAlert('success', `¡Cita creada! ID: ${out.id || '(recibido)'}`);
          setTimeout(()=> modal.hide(), 1500);
        }catch(err){
          setAlert('danger', err.message);
        }finally{
          btnConfirm.disabled = false;
          btnConfirm.textContent = 'Confirmar cita';
        }
      });
    })();
  </script>
  <!-- ================== FIN JS de la integración de citas ================== -->

  <!-- ===================== JAVASCRIPT PARA AGENDAR CITA MÉDICA (replicado de indexSalud) ===================== -->
  <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
  
  <script>
    // Variables globales
    let isLoading = false;
    window.fechaSeleccionadaGlobal = null;
    window.duracionSeleccionadaGlobal = null;

    // Función para mostrar/ocultar el formulario
    function showForm() {
      document.getElementById('formModal').style.display = 'block';
      document.getElementById('message').classList.add('hidden');
      document.getElementById('reservaForm').reset();
      
      // Restaurar la visibilidad del formulario
      const form = document.getElementById('reservaForm');
      if (form) {
          form.style.display = 'block';
      }
    }
    window.showForm = showForm;
    
    // Alias para showFormModal (usado en el botón "Estoy en la guardia")
    function showFormModal(queueId = '13946') {
      // Establecer el ID de la cola globalmente para que se use en la reserva
      window.currentQueueId = queueId;
      showForm();
    }
    window.showFormModal = showFormModal;

    function hideForm() {
      document.getElementById('formModal').style.display = 'none';
    }
    window.hideForm = hideForm;

    // Función para mostrar mensajes
    function showMessage(text, isError = false) {
        const messageDiv = document.getElementById('message');
        messageDiv.textContent = text;
        messageDiv.className = `p-4 rounded-lg mb-4 ${isError ? 'bg-red-100 text-red-700' : 'bg-green-100 text-green-700'}`;
        messageDiv.classList.remove('hidden');
    }

    // Función para manejar el envío del formulario
    async function handleSubmit(event) {
        event.preventDefault();
        
        if (isLoading) return;
        
        isLoading = true;
        const submitBtn = document.getElementById('submitBtn');
        submitBtn.textContent = 'Reservando...';
        submitBtn.disabled = true;

        const formData = new FormData(event.target);
        const data = {
            firstName: formData.get('firstName'),
            lastName: formData.get('lastName'),
            dni: formData.get('dni'),
            email: formData.get('email'),
            phone: formData.get('phone')
        };

        try {
            // Obtener el ID de la cola desde la variable global
            const queueId = window.currentQueueId || '13946'; // Default a 14003 si no se estableció
            
            const response = await fetch(`https://filavirtual2.debmedia.com/api/v1/queue/${queueId}/branch/10678/enqueue`, {
                method: 'POST',
                headers: {
                    'x-api-token': 'VdgM0qumojDq2A2BYsd9lyi6FY4BbSRblCwroXmS',
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(data)
            });

            if (response.ok) {
                const responseData = await response.json();
                
                // Extraer información del turno con fallbacks mejorados
                let turnInfo = {
                    turno: 'N/A',
                    tiempoEspera: 'N/A',
                    especialidad: 'N/A',
                    salaEspera: 'N/A',
                    codigo: responseData.code || 'N/A', // Agregar el código del turno
                    videoCallUrl: null // Agregar campo para URL de videollamada
                };
                
                // Verificar si existe videoCallUrl en el response
                if (responseData.videoCallUrl) {
                    turnInfo.videoCallUrl = responseData.videoCallUrl;
                } else if (responseData.jsonDetails?.videoCallUrl) {
                    turnInfo.videoCallUrl = responseData.jsonDetails.videoCallUrl;
                } else if (responseData.jsonDetails?.queue?.videoCallUrl) {
                    turnInfo.videoCallUrl = responseData.jsonDetails.queue.videoCallUrl;
                }
                
                // Intentar extraer datos de diferentes estructuras posibles
                if (responseData.jsonDetails) {
                    turnInfo.turno = responseData.jsonDetails.actualTurn || responseData.jsonDetails.turn || 'N/A';
                    turnInfo.tiempoEspera = responseData.jsonDetails.averageWaitingTime || responseData.jsonDetails.serviceTime || 'N/A';
                    turnInfo.especialidad = responseData.jsonDetails.queue?.name || 'N/A';
                    turnInfo.salaEspera = responseData.jsonDetails.waitingRoom?.name || 'N/A';
                } else if (responseData.code) {
                    // Si no hay jsonDetails, usar datos del nivel principal
                    turnInfo.turno = responseData.code || 'N/A';
                    turnInfo.tiempoEspera = responseData.jsonDetails?.serviceTime || 'N/A';
                    turnInfo.especialidad = 'Atención General';
                    turnInfo.salaEspera = 'Sala Principal';
                }
                
                // Guardar el código del turno en localStorage
                if (responseData.code) {
                    localStorage.setItem('turnCode', responseData.code);
                }
                
                // IMPORTANTE: Mostrar información del turno ANTES de cualquier otra cosa
                showTurnInfoInModal(turnInfo);
                
            } else {
                // Intentar leer el body del error
                try {
                    const errorText = await response.text();
                    
                    // Intentar parsear como JSON si es posible
                    try {
                        const errorJson = JSON.parse(errorText);
                    } catch (parseError) {
                        // Error Body no es JSON válido
                    }
                    
                    // Mostrar el error en la página también
                    if (message) {
                        message.innerHTML += `
                            <div class="alert alert-danger mt-2">
                                <h5>❌ Error Response Details:</h5>
                                <p><strong>Status:</strong> ${response.status}</p>
                                <p><strong>Status Text:</strong> ${response.statusText}</p>
                                <p><strong>Error Body:</strong> ${errorText}</p>
                            </div>
                        `;
                    }
                    
                } catch (readError) {
                    // Mostrar error de lectura en la página
                    if (message) {
                        message.innerHTML += `
                            <div class="alert alert-warning mt-2">
                                <h5>⚠️ Error Reading Response:</h5>
                                <p>No se pudo leer el body del error: ${readError.message}</p>
                            </div>
                        `;
                    }
                }
                
                throw new Error('Error en la respuesta del servidor: ' + response.status);
            }
        } catch (error) {
            showErrorInModal('Error al reservar el turno: ' + error.message);
        } finally {
            isLoading = false;
            submitBtn.textContent = 'Reservar Turno';
            submitBtn.disabled = false;
        }
        
        // IMPORTANTE: Prevenir que el formulario se envíe
        return false;
    }
    
    // Hacer la función handleSubmit disponible globalmente
    window.handleSubmit = handleSubmit;

    // Función para mostrar errores dentro del modal
    function showErrorInModal(errorMessage) {
        try {
            const form = document.getElementById('reservaForm');
            
            if (!form) {
                return;
            }
            
            const errorHTML = `
                <div class="error-container">
                    <div class="error-icon">
                        <i class="bi bi-exclamation-triangle-fill" style="font-size: 3rem; color: #dc3545;"></i>
                    </div>
                    <h4 class="text-lg font-semibold text-center mb-4" style="color: #dc3545;">Error en la Reserva</h4>
                    <p class="error-message text-center mb-4">${errorMessage}</p>
                    <div class="text-center">
                        <button class="boton-fecha" onclick="resetFormInModal()">Intentar de Nuevo</button>
                        <button class="boton-fecha" onclick="hideForm()" style="margin-left: 10px; background-color: #6c757d;">Cerrar</button>
                    </div>
                </div>
            `;
            
            form.innerHTML = errorHTML;
            
        } catch (error) {
            // Error en showErrorInModal
        }
    }
    
    // Función para resetear el formulario en el modal
    function resetFormInModal() {
        const form = document.getElementById('reservaForm');
        
        const formHTML = `
            <label>Nombre</label>
            <input type="text" name="firstName" required class="input-field" />

            <label>Apellido</label>
            <input type="text" name="lastName" required class="input-field" />

            <label>DNI</label>
            <input type="text" name="dni" required class="input-field" />

            <label>Email</label>
            <input type="email" name="email" required class="input-field" />

            <label>Teléfono</label>
            <input type="tel" name="phone" required class="input-field" />

            <div class="d-flex justify-content-between pt-3">
                <button type="submit" class="boton-fecha" id="submitBtn">Reservar Turno</button>
                <button type="button" class="boton-fecha" onclick="hideForm()">Cancelar</button>
            </div>
        `;
        
        form.innerHTML = formHTML;
        
        // Reasignar el event listener
        form.addEventListener('submit', handleSubmit);
    }
    
    // Hacer la función globalmente accesible
    window.resetFormInModal = resetFormInModal;
    
    // Función para mostrar información del turno dentro del modal
    function showTurnInfoInModal(turnInfo) {
        try {
            // Obtener elementos del DOM
            const form = document.getElementById('reservaForm');
            const message = document.getElementById('message');
            
            if (!form) {
                return;
            }
            
            // Obtener el código del turno desde turnInfo
            const turnCode = turnInfo.codigo;
            
            // Crear el HTML para mostrar la información del turno con actualizaciones en tiempo real
            const turnInfoHTML = `
                <div class="turn-info-container">
                    <h4 class="text-lg font-semibold text-center mb-4" style="color: #863DFF;">✅ Turno Reservado Exitosamente</h4>
                    <p class="text-center mb-4" style="color: #28a745; font-weight: 600;">¡Tu turno ha sido generado en el sistema!</p>
                    <div class="turn-info-grid">
                        <div class="turn-info-item">
                            <div class="turn-info-label">Código del Turno:</div>
                            <div class="turn-info-value" id="turnCodeDisplay">${turnCode || 'No disponible'}</div>
                        </div>
                        <div class="turn-info-item">
                            <div class="turn-info-label">Número de Turno:</div>
                            <div class="turn-info-value">${turnInfo.turno}</div>
                        </div>
                        <div class="turn-info-item">
                            <div class="turn-info-label">Estado del Turno:</div>
                            <div class="turn-info-value" id="turnStatus">Consultando...</div>
                        </div>
                        <div class="turn-info-item">
                            <div class="turn-info-label">Tiempo de Espera Actual:</div>
                            <div class="turn-info-value" id="currentWaitingTime">Consultando...</div>
                        </div>
                        <div class="turn-info-item">
                            <div class="turn-info-label">Tiempo Promedio de Espera:</div>
                            <div class="turn-info-value">${turnInfo.tiempoEspera} min</div>
                        </div>
                        <div class="turn-info-item">
                            <div class="turn-info-label">Especialidad:</div>
                            <div class="turn-info-value">${turnInfo.especialidad}</div>
                        </div>
                        <div class="turn-info-item">
                            <div class="turn-info-label">Sala de Espera:</div>
                            <div class="turn-info-value">${turnInfo.salaEspera}</div>
                        </div>
                    </div>
                    ${turnInfo.videoCallUrl ? `
                        <div class="text-center mt-3">
                            <button onclick="showVideoCall('${turnInfo.videoCallUrl}')" class="video-call-btn">
                                🎥 Iniciar Videollamada
                            </button>
                        </div>
                    ` : ''}
                    <div class="text-center mt-4">
                        <button class="boton-fecha" onclick="hideForm()">Cerrar</button>
                    </div>
                </div>
            `;
            
            // Ocultar el formulario y mostrar la información del turno
            form.style.display = 'none';
            message.innerHTML = turnInfoHTML;
            message.classList.remove('hidden');
            
            // Iniciar el polling del estado del turno
            if (turnCode && turnCode !== 'N/A' && turnCode !== 'No disponible') {
                startTurnStatusPolling(turnCode);
            }
            
        } catch (error) {
            // Mostrar mensaje de error genérico
            const form = document.getElementById('reservaForm');
            const message = document.getElementById('message');
            
            if (form && message) {
                form.style.display = 'none';
                message.innerHTML = `
                    <div class="error-container">
                        <h4 class="text-lg font-semibold text-center mb-4" style="color: #dc3545;">❌ Error al mostrar información del turno</h4>
                        <p class="text-center mb-4">Hubo un problema al procesar la información del turno.</p>
                        <div class="text-center">
                            <button class="boton-fecha" onclick="showForm()">Volver</button>
                        </div>
                    </div>
                `;
                message.classList.remove('hidden');
            }
        }
    }

    // Función para reservar turno real invocando el API
    async function reservarTurnoReal() {
        
        // Mostrar mensaje inicial en la página
        const message = document.getElementById('message');
        if (message) {
            message.innerHTML = `
            
            `;
            message.classList.remove('hidden');
        }
        
        // Obtener los datos del formulario
        const form = document.getElementById('reservaForm');
        const firstName = form.querySelector('input[name="firstName"]').value;
        const lastName = form.querySelector('input[name="lastName"]').value;
        const dni = form.querySelector('input[name="dni"]').value;
        const email = form.querySelector('input[name="email"]').value;
        const phone = form.querySelector('input[name="phone"]').value;
        
        // Validar que todos los campos estén completos
        if (!firstName || !lastName || !dni || !email || !phone) {
            alert('Por favor, completa todos los campos del formulario');
            return;
        }
        
        // Cambiar el botón a estado de carga
        const submitBtn = document.getElementById('submitBtn');
        const originalText = submitBtn.textContent;
        submitBtn.textContent = 'Reservando...';
        submitBtn.disabled = true;
        
        try {
            
            // Mostrar en la página que se va a enviar la petición
       /*     if (message) {
                message.innerHTML += `
                    <div class="alert alert-warning mt-2">
                        <h5>📡 Enviando petición a la API...</h5>
                        <p>Conectando con el servidor...</p>
                    </div>
                `;
            }*/
            
            // Preparar el payload del request
            const requestPayload = {
                firstName,
                lastName,
                dni,
                email,
                phone
            };
            
            
            // Obtener el ID de la cola desde la variable global
            const queueId = window.currentQueueId || '13946'; // Default a 14003 si no se estableció
            
            const response = await fetch(`https://filavirtual2.debmedia.com/api/v1/queue/${queueId}/branch/10678/enqueue`, {
                method: 'POST',
                headers: {
                    'x-api-token': 'VdgM0qumojDq2A2BYsd9lyi6FY4BbSRblCwroXmS',
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(requestPayload)
            });
            
            
            if (response.ok) {
                const responseData = await response.json();
                
                // Extraer información del turno con fallbacks mejorados
                let turnInfo = {
                    turno: 'N/A',
                    tiempoEspera: 'N/A',
                    especialidad: 'N/A',
                    salaEspera: 'N/A',
                    codigo: responseData.code || 'N/A', // Agregar el código del turno
                    videoCallUrl: null // Agregar campo para URL de videollamada
                };
                
                // Verificar si existe videoCallUrl en el response
                if (responseData.videoCallUrl) {
                    turnInfo.videoCallUrl = responseData.videoCallUrl;
                } else if (responseData.jsonDetails?.videoCallUrl) {
                    turnInfo.videoCallUrl = responseData.jsonDetails.videoCallUrl;
                } else if (responseData.jsonDetails?.queue?.videoCallUrl) {
                    turnInfo.videoCallUrl = responseData.jsonDetails.queue.videoCallUrl;
                }
                
                // Intentar extraer datos de diferentes estructuras posibles
                if (responseData.jsonDetails) {
                    turnInfo.turno = responseData.jsonDetails.turn || responseData.jsonDetails.actualTurn || 'N/A';
                    turnInfo.tiempoEspera = responseData.jsonDetails.serviceTime || responseData.jsonDetails.averageWaitingTime || 'N/A';
                    turnInfo.especialidad = responseData.jsonDetails.queue?.name || 'N/A';
                    turnInfo.salaEspera = responseData.jsonDetails.waitingRoom?.name || 'N/A';
                } else if (responseData.code) {
                    // Si no hay jsonDetails, usar datos del nivel principal
                    turnInfo.turno = responseData.code || 'N/A';
                    turnInfo.tiempoEspera = responseData.jsonDetails?.serviceTime || 'N/A';
                    turnInfo.especialidad = 'Atención General';
                    turnInfo.salaEspera = 'Sala Principal';
                }
                
                // Redondear el tiempo de espera para mostrar solo la parte entera
                if (turnInfo.tiempoEspera !== 'N/A' && !isNaN(turnInfo.tiempoEspera)) {
                    const tiempoOriginal = turnInfo.tiempoEspera;
                    turnInfo.tiempoEspera = Math.floor(parseFloat(turnInfo.tiempoEspera));
                }
                
                // Guardar el código del turno en localStorage
                if (responseData.code) {
                    localStorage.setItem('turnCode', responseData.code);
                }
                
                // Mostrar la información del turno en el modal
                showTurnInfoInModal(turnInfo);
                
            } else {
                
                // Intentar leer el body del error
                try {
                    const errorText = await response.text();
                    
                    // Intentar parsear como JSON si es posible
                    try {
                        const errorJson = JSON.parse(errorText);
                    } catch (parseError) {
                        // Error Body no es JSON válido
                    }
                    
                    // Mostrar el error en la página también
                    if (message) {
                        message.innerHTML += `
                            <div class="alert alert-danger mt-2">
                                <h5>❌ Error Response Details:</h5>
                                <p><strong>Status:</strong> ${response.status}</p>
                                <p><strong>Status Text:</strong> ${response.statusText}</p>
                                <p><strong>Error Body:</strong> ${errorText}</p>
                            </div>
                        `;
                    }
                    
                } catch (readError) {
                    // Mostrar error de lectura en la página
                    if (message) {
                        message.innerHTML += `
                            <div class="alert alert-warning mt-2">
                                <h5>⚠️ Error Reading Response:</h5>
                                <p>No se pudo leer el body del error: ${readError.message}</p>
                            </div>
                        `;
                    }
                }
                
                throw new Error('Error en la respuesta del servidor: ' + response.status);
            }
            
        } catch (error) {
            // Mostrar error en el modal
            showErrorInModal('Error al reservar el turno: ' + error.message);
            
        } finally {
            // Restaurar el botón
            submitBtn.textContent = originalText;
            submitBtn.disabled = false;
        }
    }
    
    // Hacer las funciones disponibles globalmente
    window.reservarTurnoReal = reservarTurnoReal;
    window.startTurnStatusPolling = startTurnStatusPolling;
    window.stopTurnStatusPolling = stopTurnStatusPolling;
    
    // Función para consultar recurrentemente el estado del turno
    function startTurnStatusPolling(turnCode) {
        // Verificar que se recibió el código del turno
        if (!turnCode || turnCode === 'N/A' || turnCode === 'No disponible') {
            return;
        }
        
        // Inicializar contador de consultas
        let callCount = 0;
        
        // Función para realizar la consulta a la API
        async function consultarEstadoTurno() {
            try {
                // Incrementar contador de consultas (solo para logging interno)
                callCount++;
                
                // Consultar la API del estado del turno
                const response = await fetch(`https://filavirtual2.debmedia.com/api/v1/turn/code/${turnCode}`, {
                    method: 'GET',
                    headers: {
                        'x-api-token': 'iyAUHKKJ2NTsxf4sAH1OWm3fljRsThvxF0kbCGWe',
                        'Content-Type': 'text/plain'
                    }
                });
                
                if (response.ok) {
                    const data = await response.json();
                    
                    // Actualizar estado del turno
                    const statusElement = document.getElementById('turnStatus');
                    if (statusElement) {
                        let statusText = data.status || 'Desconocido';
                        
                        // Traducir estados específicos
                        if (data.status === 'ANNOUNCED') {
                            statusText = 'Lo estamos llamando';
                        } else if (data.status === 'WAITING_TO_BE_CALLED') {
                            statusText = 'En breve lo llamaremos';
                        } else if (data.status === 'FINALIZED') {
                            statusText = 'Atención finalizada';
                        }
                        
                        statusElement.textContent = statusText;
                        statusElement.style.color = getStatusColor(data.status);
                    }
                    
                    // Actualizar tiempo de espera actual
                    const waitingTimeElement = document.getElementById('currentWaitingTime');
                    if (waitingTimeElement) {
                        waitingTimeElement.textContent = data.averageWaitingTime ? `${data.averageWaitingTime} min` : 'N/A';
                    }
                    
                } else {
                    // Mostrar error en los elementos
                    const statusElement = document.getElementById('turnStatus');
                    const waitingTimeElement = document.getElementById('currentWaitingTime');
                    
                    if (statusElement) {
                        statusElement.textContent = 'Error al consultar';
                        statusElement.style.color = '#dc3545';
                    }
                    
                    if (waitingTimeElement) {
                        waitingTimeElement.textContent = 'Error al consultar';
                        waitingTimeElement.style.color = '#dc3545';
                    }
                }
                
            } catch (error) {
                
                // Mostrar error en los elementos
                const statusElement = document.getElementById('turnStatus');
                const waitingTimeElement = document.getElementById('currentWaitingTime');
                
                if (statusElement) {
                    statusElement.textContent = 'Error de conexión';
                    statusElement.style.color = '#dc3545';
                }
                
                if (waitingTimeElement) {
                    waitingTimeElement.textContent = 'Error de conexión';
                    waitingTimeElement.style.color = '#dc3545';
                }
            }
        }
        
        // Función para obtener color según el estado
        function getStatusColor(status) {
            const statusLower = status.toLowerCase();
            if (statusLower.includes('espera') || statusLower.includes('waiting')) return '#ffc107';
            if (statusLower.includes('atendiendo') || statusLower.includes('attending')) return '#28a745';
            if (statusLower.includes('completado') || statusLower.includes('completed')) return '#17a2b8';
            if (statusLower.includes('cancelado') || statusLower.includes('cancelled')) return '#dc3545';
            return '#6c757d';
        }
        
        // Realizar la primera consulta inmediatamente
        consultarEstadoTurno();
        
        // Configurar consultas recurrentes cada 5 segundos
        const pollingInterval = setInterval(consultarEstadoTurno, 5000);
        
        // Guardar el intervalo para poder detenerlo si es necesario
        window.turnStatusPollingInterval = pollingInterval;
    }
    
    // Función para detener las consultas recurrentes (opcional)
    function stopTurnStatusPolling() {
        if (window.turnStatusPollingInterval) {
            clearInterval(window.turnStatusPollingInterval);
            window.turnStatusPollingInterval = null;
        }
    }

    // Configurar flatpickr para el selector de fechas
    flatpickr("#fecha", {
      dateFormat: "Y-m-d",
      minDate: "today", // evitar fechas anteriores
      onChange: function(selectedDates, dateStr) {
        if (selectedDates.length > 0) {
          consultarDisponibilidad(dateStr);
        }
      }
    });

    async function consultarDisponibilidad(strDate) {
      const resultados = document.getElementById("resultados");
      resultados.innerHTML = "Consultando disponibilidad...";

      const baseUrl = "https://citas2.debmedia.com/api/v2/schedules";
      const strDateEncoded = encodeURIComponent(strDate);
      const branchId = document.getElementById("sucuComboValue").value;
      const scheduleId = document.getElementById("salaComboValue").value;
      const url = `${baseUrl}/${scheduleId}/branch/${branchId}/availability?strDate=${strDateEncoded}`;

      try {
        const response = await fetch(url, {
          method: "GET",
          headers: {
            "x-api-token": "VwJ3ACdnXWPdnjEwLxs0mKoRHvCU23tGLYryRiF1"
          } 
        });

        if (!response.ok) throw new Error("Error en la solicitud: " + response.status);
        const data = await response.json();

        const dias = Array.isArray(data) ? data : (Array.isArray(data.slots) ? data.slots : []);

        if (dias.length === 0) {
          resultados.innerHTML = "No hay horarios disponibles para esta fecha.";
          return;
        }

        let html = "<div><h3 class='titulo'>Horarios disponibles:</h3></div>";
        html+="<div>"
        dias.forEach(dia => {
          const horaMinuto = dia.zonedStartDate.substring(11, 16);
          html += `&nbsp<button class="boton-fecha" onclick="mostrarFormulario('${dia.zonedStartDate}', ${dia.defaultDuration})">${horaMinuto}</button>&nbsp`;
        });
        html+="</div>"
        resultados.innerHTML = html;

      } catch (err) {
        resultados.innerHTML = `<strong>Error:</strong> ${err.message}`;
      }
    }

    function mostrarFormulario(fecha, duracion) {
      window.fechaSeleccionadaGlobal = fecha;
      window.duracionSeleccionadaGlobal = duracion;

      const resultados = document.getElementById("formularioDatos");
      document.getElementById("formularioDatos").style.display = "block";

      document.getElementById("resultados").style.display = "none";

      let html = `
        <h3 class='titulo'>Completa tus datos</h3>
        <form id="formularioTurno" onsubmit="return enviarFormulario(event)">
          <label>Nombre:</label>
          <input type="text" id="nombre" required>
          <label>Apellido:</label>
          <input type="text" id="apellido" required>
          <label>DNI:</label>
          <input type="text" id="dni" required>
          <label>Email:</label>
          <input type="email" id="email" required>
          <label>Motivo:</label>
          <select id="motivo" required>
            <option value="">Seleccionar...</option>
            <option value="Consulta general">Consulta general</option>
            <option value="Revisión">Revisión</option>
            <option value="Control de tratamiento">Control de tratamiento</option>
          </select>
          <br><br>
          <button type="submit" class="boton-fecha">Confirmar Turno</button>
        </form>
      `;
      resultados.innerHTML = html;
    }
    window.mostrarFormulario = mostrarFormulario;
    
    function enviarFormulario(event) {
      event.preventDefault();
      const datos = {
        nombre: document.getElementById("nombre").value,
        apellido: document.getElementById("apellido").value,
        dni: parseInt(document.getElementById("dni").value),
        email: document.getElementById("email").value,
        motivo: document.getElementById("motivo").value
      };

      crearCita(window.fechaSeleccionadaGlobal, window.duracionSeleccionadaGlobal, datos);
    }

    async function crearCita(fechaInicio, duracionMinutos, datosCliente) {
      const resultados = document.getElementById("final");

      const startDate = new Date(fechaInicio);
      const endDate = new Date(startDate.getTime() + duracionMinutos * 60000);

      const pad = n => n.toString().padStart(2, '0');
      resultados.innerHTML = `1`;
      function formatISO(date) {
        const yyyy = date.getFullYear();
        const MM = pad(date.getMonth() + 1);
        const dd = pad(date.getDate());
        const hh = pad(date.getHours());
        const mm = pad(date.getMinutes());
        return `${yyyy}-${MM}-${dd}T${hh}:${mm}:00-0300`;
      }

      const startAt = formatISO(startDate);
      const endAt = formatISO(endDate);

      const data = {
        branch: { id:  document.getElementById("sucuComboValue").value },
        schedule: { id:  document.getElementById("salaComboValue").value },
        startAt: startAt,
        endAt: endAt,
        customer: {
          firstName: datosCliente.nombre,
          lastName: datosCliente.apellido,
          dni: datosCliente.dni,
          email: datosCliente.email
        },
        reason: datosCliente.motivo
      };
      try {
        const response = await fetch("https://citas2.debmedia.com/api/v2/appointments", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
            "x-api-token": "VwJ3ACdnXWPdnjEwLxs0mKoRHvCU23tGLYryRiF1"
          },
          body: JSON.stringify(data)
        });

        const resultado = await response.json();

        if (!response.ok) {
          throw new Error(`Error ${response.status}: ${resultado.message || JSON.stringify(resultado)}`);
        }

        document.getElementById("formularioDatos").style.display = "none";
        resultados.innerHTML = `<strong>✅ La reserva fue creada correctamente. ID: ${resultado.id}</strong>`;

      } catch (error) {
        resultados.innerHTML = `<strong>❌ Error al generar la cita:</strong> ${error.message}`;
      }
    }

    async function cargarCombosDesdeAPI() {
      const salaCombo = document.getElementById("salaCombo");
      const sucuCombo = document.getElementById("sucuCombo");

      // Configurar flatpickr
      flatpickr("#fecha", {
        dateFormat: "Y-m-d",
        minDate: "today",
        onChange: function(selectedDates, dateStr) {
          if (selectedDates.length > 0) {
            consultarDisponibilidad(dateStr);
          }
        }
      });

      // Cargar sucursales desde la API
      const url = `https://citas2.debmedia.com/api/v2/reducedSchedules`;

      try {
        const response = await fetch(url, {
          method: "GET",
          headers: {
            "x-api-token": "VwJ3ACdnXWPdnjEwLxs0mKoRHvCU23tGLYryRiF1"
          }
        });

        if (!response.ok) throw new Error("No se pudo cargar la lista de sucursales");
        const data = await response.json();

        // Limpiar y preparar el contenedor de sucursales
        sucuCombo.innerHTML = '';
        
        const addedBranchIds = new Set();
        
        data.forEach(sala => {
          if (Array.isArray(sala.branches)) {
            sala.branches.forEach(branch => {
              if (!addedBranchIds.has(branch.id)) {
                // Crear card de sucursal
                const sucursalCard = document.createElement('div');
                sucursalCard.className = 'sucursal-card';
                sucursalCard.dataset.value = branch.id;
                sucursalCard.innerHTML = `
                  <i class="bi bi-building sucursal-icon"></i>
                  <div class="sucursal-info">
                    <div class="sucursal-name">${branch.name}</div>
                    <div class="sucursal-status">Disponible</div>
                  </div>
                `;
                
                // Agregar evento de click
                sucursalCard.addEventListener('click', function() {
                  // Remover selección previa
                  document.querySelectorAll('.sucursal-card').forEach(card => {
                    card.classList.remove('selected');
                  });
                  
                  // Seleccionar esta card
                  this.classList.add('selected');
                  
                  // Actualizar el valor oculto
                  document.getElementById('sucuComboValue').value = branch.id;
                  
                  // Cargar salas basadas en especialidad y sucursal seleccionadas
                  cargarSalasPorEspecialidadYSucursal();
                });
                
                sucuCombo.appendChild(sucursalCard);
                addedBranchIds.add(branch.id);
              }
            });
          }
        });
        
        // Agregar eventos de click para las especialidades
        document.querySelectorAll('.especialidad-card').forEach(card => {
          card.addEventListener('click', function() {
            // Remover selección previa
            document.querySelectorAll('.especialidad-card').forEach(c => {
              c.classList.remove('selected');
            });
            
            // Seleccionar esta card
            this.classList.add('selected');
            
            // Actualizar el valor oculto
            document.getElementById('especialidadComboValue').value = this.dataset.value;
            
            // Mostrar el selector de sucursales
            document.querySelector('.sucursal-selector').style.display = 'block';
            
            // Cargar salas basadas en especialidad y sucursal seleccionadas
            cargarSalasPorEspecialidadYSucursal();
          });
        });

        document.getElementById('popupModal').style.display='block';

      } catch (err) {
        sucuCombo.innerHTML = `<div class="error-card">
          <i class="bi bi-exclamation-triangle"></i>
          <span>Error cargando sucursales</span>
        </div>`;
      }
    }
    
    // Hacer la función globalmente accesible
    window.cargarCombosDesdeAPI = cargarCombosDesdeAPI;

    // Nueva función para cargar salas basadas en especialidad y sucursal
    async function cargarSalasPorEspecialidadYSucursal() {
      const salaCombo = document.getElementById("salaCombo");
      const especialidadSeleccionada = document.getElementById("especialidadComboValue").value;
      const sucursalSeleccionada = document.getElementById("sucuComboValue").value;

      // Validar que ambos estén seleccionados
      if (!especialidadSeleccionada || !sucursalSeleccionada) {
        salaCombo.innerHTML = `<div class="loading-card">
          <i class="bi bi-arrow-clockwise spin"></i>
          <span>Selecciona especialidad y sucursal para ver las salas disponibles</span>
        </div>`;
        return;
      }

      // Usar directamente el data-value de la especialidad seleccionada
      const especialidadValue = especialidadSeleccionada;
      
      // Mostrar loading
      salaCombo.innerHTML = `<div class="loading-card">
        <i class="bi bi-arrow-clockwise spin"></i>
        <span>Cargando salas para ${especialidadValue}...</span>
      </div>`;

      try {
        // Construir URL con parámetros usando directamente el data-value
        const url = `https://citas2.debmedia.com/api/v2/schedules?tags.name=${encodeURIComponent(especialidadValue)}`;
        
        const response = await fetch(url, {
          method: "GET",
          headers: {
            "x-api-token": "VwJ3ACdnXWPdnjEwLxs0mKoRHvCU23tGLYryRiF1"
          }
        });

        if (!response.ok) throw new Error("No se pudo cargar la lista de salas");
        const data = await response.json();

        // Limpiar contenedor de salas
        salaCombo.innerHTML = '';
        
        // Filtrar salas que pertenezcan a la sucursal seleccionada
        const salasFiltradas = data.filter(sala => {
          return Array.isArray(sala.branches) && 
                 sala.branches.some(branch => branch.id === parseInt(sucursalSeleccionada));
        });

        if (salasFiltradas.length === 0) {
          salaCombo.innerHTML = `<div class="error-card">
            <i class="bi bi-exclamation-triangle"></i>
            <span>No hay salas disponibles para ${especialidadValue} en esta sucursal</span>
          </div>`;
          return;
        }

        // Crear cards de salas
        salasFiltradas.forEach(sala => {
          const salaCard = document.createElement('div');
          salaCard.className = 'sala-card';
          salaCard.dataset.value = sala.id;
          salaCard.innerHTML = `
            <i class="bi bi-door-open sala-icon"></i>
            <div class="sala-info">
              <div class="sala-name">${sala.name}</div>
              <div class="sala-status">Disponible</div>
            </div>
          `;
          
          // Agregar evento de click para sala
          salaCard.addEventListener('click', function() {
            // Remover selección previa
            document.querySelectorAll('.sala-card').forEach(card => {
              card.classList.remove('selected');
            });
            
            // Seleccionar esta card
            this.classList.add('selected');
            
            // Actualizar el valor oculto
            document.getElementById('salaComboValue').value = sala.id;
            
            // Mostrar bloque de fecha cuando se selecciona una sala
            document.getElementById("bloqueFecha").style.display = "block";
          });
          
          salaCombo.appendChild(salaCard);
        });

      } catch (err) {
        salaCombo.innerHTML = `<div class="error-card">
          <i class="bi bi-exclamation-triangle"></i>
          <span>Error cargando salas: ${err.message}</span>
        </div>`;
      }
    }

    // Event listeners
    document.addEventListener('click', function(event) {
      if (event.target.classList.contains('modal')) {
        event.target.style.display = 'none';
      }
    });

    document.getElementById('reservaForm').addEventListener('submit', handleSubmit);

    // Cerrar modal al hacer clic fuera de él (solo cuando esté habilitado)
    document.getElementById('formModal').addEventListener('click', function(e) {
        if (e.target === this && this.style.pointerEvents !== 'none') {
            hideForm();
        }
    });

    // Función para abrir popup de videollamada
    function openViajeroPopup() {
        const url = 'https://filavirtual2.debmedia.com/app/buscar/ventasalud?queueName=Atención con especialista - Videollamada&branchId=10387';
        const popup = window.open(url, 'ViajeroPopup', 'width=800,height=600,scrollbars=yes,resizable=yes');
        
        // Enfocar el popup si se abrió correctamente
        if (popup) {
            popup.focus();
        } else {
            // Si el popup fue bloqueado, mostrar mensaje
            showErrorMessage('El popup fue bloqueado. Por favor, permite popups para este sitio.');
        }
    }
    window.openViajeroPopup = openViajeroPopup;

    // Función para mostrar mensaje de error
    function showErrorMessage(message) {
        const messageDiv = document.createElement('div');
        messageDiv.className = 'fixed top-4 right-4 bg-red-500 text-white px-6 py-4 rounded-lg shadow-lg z-50 transform transition-all duration-300';
        messageDiv.innerHTML = `
            <div class="flex items-center">
                <i class="bi bi-exclamation-triangle-fill" style="margin-right: 0.75rem;"></i>
                <span>${message}</span>
            </div>
        `;
        document.body.appendChild(messageDiv);

        // Remover después de 5 segundos
        setTimeout(() => {
            messageDiv.remove();
        }, 5000);
    }
    window.showErrorMessage = showErrorMessage;
  </script>
  <!-- =================== FIN JAVASCRIPT PARA AGENDAR CITA MÉDICA =================== -->

  <!-- ===================== SCRIPT DEL SIMULADOR DE SEGUROS DE AUTO ===================== -->
  <script>
    // Variables del simulador
    let tipoVehiculoSeleccionado = '';
    let coberturaSeleccionada = '';
    
    // Función para seleccionar tipo de vehículo (Paso 1)
    function seleccionarTipoVehiculo(tipo) {
        tipoVehiculoSeleccionado = tipo;
        
        // Ocultar paso 1 y mostrar paso 2
        document.getElementById('paso1').style.display = 'none';
        document.getElementById('paso2').style.display = 'block';
    }
    
    // Función para seleccionar cobertura (Paso 2)
    function seleccionarCobertura(cobertura) {
        coberturaSeleccionada = cobertura;
        
        // Calcular prima según selección
        let prima = calcularPrima(tipoVehiculoSeleccionado, cobertura);
        
        // Mostrar resultado
        document.getElementById('tipoVehiculoSeleccionado').textContent = obtenerNombreVehiculo(tipoVehiculoSeleccionado);
        document.getElementById('coberturaSeleccionada').textContent = obtenerNombreCobertura(cobertura);
        document.getElementById('primaMensual').textContent = `$${prima} MXN/mes`;
        
        // Ocultar paso 2 y mostrar resultado
        document.getElementById('paso2').style.display = 'none';
        document.getElementById('resultadoSimulador').style.display = 'block';
    }
    
    // Función para calcular prima
    function calcularPrima(tipoVehiculo, cobertura) {
        let base = 0;
        
        // Base según tipo de vehículo
        switch(tipoVehiculo) {
            case 'auto': base = 250; break;
            case 'camioneta': base = 320; break;
            case 'moto': base = 180; break;
            default: base = 250;
        }
        
        // Multiplicador según cobertura
        switch(cobertura) {
            case 'basica': return base;
            case 'completa': return Math.round(base * 1.5);
            case 'premium': return Math.round(base * 2.2);
            default: return base;
        }
    }
    
    // Función para obtener nombre del vehículo
    function obtenerNombreVehiculo(tipo) {
        switch(tipo) {
            case 'auto': return 'Automóvil';
            case 'camioneta': return 'Camioneta/SUV';
            case 'moto': return 'Motocicleta';
            default: return 'Vehículo';
        }
    }
    
    // Función para obtener nombre de la cobertura
    function obtenerNombreCobertura(cobertura) {
        switch(cobertura) {
            case 'basica': return 'Básica (Responsabilidad Civil)';
            case 'completa': return 'Completa (Colisión + Robo)';
            case 'premium': return 'Premium (Todo Riesgo)';
            default: return 'Cobertura';
        }
    }
    
    // Función para volver al paso 1
    function volverPaso1() {
        document.getElementById('paso2').style.display = 'none';
        document.getElementById('paso1').style.display = 'block';
    }
    
    // Función para reiniciar simulador
    function reiniciarSimulador() {
        tipoVehiculoSeleccionado = '';
        coberturaSeleccionada = '';
        
        document.getElementById('resultadoSimulador').style.display = 'none';
        document.getElementById('paso1').style.display = 'block';
    }
    
    // Función para hablar con asesor
    function hablarConAsesor() {
        const url = 'https://filavirtual2.debmedia.com/app/buscar/ventasalud?queueName=Atención con especialista - Videollamada&branchId=10678';
        const popup = window.open(url, 'AsesorPopup', 'width=800,height=600,scrollbars=yes,resizable=yes');
        
        // Enfocar el popup si se abrió correctamente
        if (popup) {
            popup.focus();
        } else {
            // Si el popup fue bloqueado, mostrar mensaje
            alert('El popup fue bloqueado. Por favor, permite popups para este sitio.');
        }
    }
    
    // Hacer las funciones del simulador globalmente accesibles
    window.volverPaso1 = volverPaso1;
    window.reiniciarSimulador = reiniciarSimulador;
    window.hablarConAsesor = hablarConAsesor;
    
  </script>
  <!-- =================== FIN SCRIPT DEL SIMULADOR =================== -->
  
  <!-- Función para mostrar la videollamada en el modal -->
  <script>
    // Función para mostrar la videollamada en el modal
    function showVideoCall(videoUrl) {
        try {
            
            // Agregar el parámetro ?videocallUser=mobile a la URL
            let finalVideoUrl = videoUrl;
            if (videoUrl && !videoUrl.includes('videocallUser=')) {
                const separator = videoUrl.includes('?') ? '&' : '?';
                finalVideoUrl = videoUrl + separator + 'videocallUser=mobile';
            }
            
            // Obtener elementos del DOM
            const message = document.getElementById('message');
            
            if (!message) {
                return;
            }
            
            // Crear el HTML para la videollamada
            const videoCallHTML = `
                <div class="video-call-container">
                    <div class="video-call-header">
                        <h4 class="video-call-title">🎥 Videollamada en curso</h4>
                        <p class="video-call-subtitle">Tu consulta virtual está lista</p>
                    </div>
                    
                    <div class="video-call-frame-container">
                        <iframe 
                            src="${finalVideoUrl}" 
                            class="video-call-iframe"
                            allow="camera; microphone; fullscreen"
                            frameborder="0"
                            scrolling="no"
                        ></iframe>
                    </div>
                    
                    <div class="video-call-actions">
                        <button class="video-call-back-btn" onclick="showTurnInfoInModal(window.lastTurnInfo)">
                            ← Volver al turno
                        </button>
                        <button class="video-call-close-btn" onclick="hideForm()">
                            Cerrar
                        </button>
                    </div>
                </div>
            `;
            
            // Reemplazar el contenido del mensaje con la videollamada
            message.innerHTML = videoCallHTML;
            
            // Guardar la información del turno para poder volver
            if (!window.lastTurnInfo) {
                window.lastTurnInfo = {
                    turno: document.querySelector('.turn-info-value')?.textContent || 'N/A',
                    tiempoEspera: document.querySelectorAll('.turn-info-value')[1]?.textContent || 'N/A',
                    especialidad: document.querySelectorAll('.turn-info-value')[2]?.textContent || 'N/A',
                    salaEspera: document.querySelectorAll('.turn-info-value')[3]?.textContent || 'N/A',
                    codigo: document.getElementById('turnCodeDisplay')?.textContent || 'N/A',
                    videoCallUrl: videoUrl
                };
            }
            
        } catch (error) {
            
            // Mostrar mensaje de error
            const message = document.getElementById('message');
            if (message) {
                message.innerHTML = `
                    <div class="error-container">
                        <h4 class="text-lg font-semibold text-center mb-4" style="color: #dc3545;">❌ Error al cargar la videollamada</h4>
                        <p class="text-center mb-4">No se pudo cargar la videollamada. Intenta nuevamente.</p>
                        <div class="text-center">
                            <button class="boton-fecha" onclick="showTurnInfoInModal(window.lastTurnInfo)">
                                Volver al turno
                            </button>
                        </div>
                    </div>
                `;
            }
        }
    }
    
    // Hacer la función disponible globalmente
    window.showVideoCall = showVideoCall;
  </script>



  <!-- CHAT (enlace actualizado con token) -->
  <iframe
    src="https://filavirtual.preprod.debmedia.com/Numiabot/#/vDNNH0AKyM1DgGhBjUUE"
    id="numia-chat-bubble"
    style="
      position: fixed;
      bottom: 24px;
      right: 24px;
      width: 370px;
      height: 550px;
      border: none;
      z-index: 9999;
      border-radius: 18px;
      overflow: hidden;
      transition: width 0.3s, height 0.3s, right 0.3s, bottom 0.3s;
      display: none;
    "
    allow="camera; microphone"
  ></iframe>
  <button id="max-chat"
    style="
      position: fixed;
      bottom: 590px;
      right: 24px;
      z-index: 10000;
      background: var(--numia-azul);
      color: #fff;
      border: none;
      border-radius: 50%;
      width: 48px;
      height: 48px;
      font-size: 1.6rem;
      box-shadow: 0 2px 8px rgba(0,0,0,0.18);
      cursor: pointer;
      display: none;
      align-items: center;
      justify-content: center;
      transition: background 0.2s;
    "
    title="Maximizar/minimizar chat"
  >⛶</button>
  <button id="open-chat"
    style="
      position: fixed;
      bottom: 24px;
      right: 24px;
      z-index: 10001;
      background: var(--numia-azul);
      color: #fff;
      border: none;
      border-radius: 50%;
      width: 64px;
      height: 64px;
      font-size: 2.5rem;
      box-shadow: 0 2px 8px rgba(0,0,0,0.18);
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
    "
    title="Abrir chat"
  >
    <span style="font-weight:bold;font-size:2rem;">N</span>
  </button>
  
  <!-- Script para detectar redirección desde broker y abrir modal -->
  <script>
    // Verificar si viene de la página de broker y debe abrirse el modal
    document.addEventListener('DOMContentLoaded', function() {
        const shouldOpenModal = localStorage.getItem('openAgendaModal');
        
        if (shouldOpenModal === 'true') {
            
            // Limpiar el flag
            localStorage.removeItem('openAgendaModal');
            
            // Esperar un poco para que la página se cargue completamente
            setTimeout(() => {
                // Verificar si la función está disponible
                if (typeof cargarCombosDesdeAPI === 'function') {
                    cargarCombosDesdeAPI();
                }
            }, 500);
        }
    });
  </script>
</body>
</html>
